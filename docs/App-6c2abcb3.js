import{A as e,W as t,M as n,R as o,U as i,S as r,a as s,b as a,c as l,I as c,d,P as u,G as f,e as h,C as p,f as v,g as m}from"./game-data-cd564084.js";var g,_,b,y,w,k,x,S={},O=[],A=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function j(e,t){for(var n in t)e[n]=t[n];return e}function C(e){var t=e.parentNode;t&&t.removeChild(e)}function q(e,t,n,o,i){var r={type:e,props:t,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:i??++b};return null!=_.vnode&&_.vnode(r),r}function E(e){return e.children}function U(e,t){this.props=e,this.context=t}function $(e,t){if(null==t)return e.__?$(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?$(e):null}function M(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return M(e)}}function N(e){(!e.__d&&(e.__d=!0)&&y.push(e)&&!I.__r++||k!==_.debounceRendering)&&((k=_.debounceRendering)||w)(I)}function I(){for(var e;I.__r=y.length;)e=y.sort((function(e,t){return e.__v.__b-t.__v.__b})),y=[],e.some((function(e){var t,n,o,i,r,s;e.__d&&(r=(i=(t=e).__v).__e,(s=t.__P)&&(n=[],(o=j({},i)).__v=i.__v+1,z(s,i,o,t.__n,void 0!==s.ownerSVGElement,null!=i.__h?[r]:null,n,r??$(i),i.__h),F(n,i),i.__e!=r&&M(i)))}))}function P(e,t,n,o,i,r,s,a,l,c){var d,u,f,h,p,v,m,g=o&&o.__k||O,_=g.length;for(n.__k=[],d=0;d<t.length;d++)if(null!=(h=n.__k[d]=null==(h=t[d])||"boolean"==typeof h?null:"string"==typeof h||"number"==typeof h||"bigint"==typeof h?q(null,h,null,null,h):Array.isArray(h)?q(E,{children:h},null,null,null):h.__b>0?q(h.type,h.props,h.key,null,h.__v):h)){if(h.__=n,h.__b=n.__b+1,null===(f=g[d])||f&&h.key==f.key&&h.type===f.type)g[d]=void 0;else for(u=0;u<_;u++){if((f=g[u])&&h.key==f.key&&h.type===f.type){g[u]=void 0;break}f=null}z(e,h,f=f||S,i,r,s,a,l,c),p=h.__e,(u=h.ref)&&f.ref!=u&&(m||(m=[]),f.ref&&m.push(f.ref,null,h),m.push(u,h.__c||p,h)),null!=p?(null==v&&(v=p),"function"==typeof h.type&&null!=h.__k&&h.__k===f.__k?h.__d=l=B(h,l,e):l=T(e,h,f,g,p,l),c||"option"!==n.type?"function"==typeof n.type&&(n.__d=l):e.value=""):l&&f.__e==l&&l.parentNode!=e&&(l=$(f))}for(n.__e=v,d=_;d--;)null!=g[d]&&("function"==typeof n.type&&null!=g[d].__e&&g[d].__e==n.__d&&(n.__d=$(o,d+1)),G(g[d],g[d]));if(m)for(d=0;d<m.length;d++)W(m[d],m[++d],m[++d])}function B(e,t,n){var o,i;for(o=0;o<e.__k.length;o++)(i=e.__k[o])&&(i.__=e,t="function"==typeof i.type?B(i,t,n):T(n,i,i,e.__k,i.__e,t));return t}function T(e,t,n,o,i,r){var s,a,l;if(void 0!==t.__d)s=t.__d,t.__d=void 0;else if(null==n||i!=r||null==i.parentNode)e:if(null==r||r.parentNode!==e)e.appendChild(i),s=null;else{for(a=r,l=0;(a=a.nextSibling)&&l<o.length;l+=2)if(a==i)break e;e.insertBefore(i,r),s=r}return void 0!==s?s:i.nextSibling}function D(e,t,n){"-"===t[0]?e.setProperty(t,n):e[t]=null==n?"":"number"!=typeof n||A.test(t)?n:n+"px"}function L(e,t,n,o,i){var r;e:if("style"===t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof o&&(e.style.cssText=o=""),o)for(t in o)n&&t in n||D(e.style,t,"");if(n)for(t in n)o&&n[t]===o[t]||D(e.style,t,n[t])}else if("o"===t[0]&&"n"===t[1])r=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+r]=n,n?o||e.addEventListener(t,r?R:H,r):e.removeEventListener(t,r?R:H,r);else if("dangerouslySetInnerHTML"!==t){if(i)t=t.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if("href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&t in e)try{e[t]=n??"";break e}catch(e){}"function"==typeof n||(null!=n&&(!1!==n||"a"===t[0]&&"r"===t[1])?e.setAttribute(t,n):e.removeAttribute(t))}}function H(e){this.l[e.type+!1](_.event?_.event(e):e)}function R(e){this.l[e.type+!0](_.event?_.event(e):e)}function z(e,t,n,o,i,r,s,a,l){var c,d,u,f,h,p,v,m,g,b,y,w=t.type;if(void 0!==t.constructor)return null;null!=n.__h&&(l=n.__h,a=t.__e=n.__e,t.__h=null,r=[a]),(c=_.__b)&&c(t);try{e:if("function"==typeof w){if(m=t.props,g=(c=w.contextType)&&o[c.__c],b=c?g?g.props.value:c.__:o,n.__c?v=(d=t.__c=n.__c).__=d.__E:("prototype"in w&&w.prototype.render?t.__c=d=new w(m,b):(t.__c=d=new U(m,b),d.constructor=w,d.render=V),g&&g.sub(d),d.props=m,d.state||(d.state={}),d.context=b,d.__n=o,u=d.__d=!0,d.__h=[]),null==d.__s&&(d.__s=d.state),null!=w.getDerivedStateFromProps&&(d.__s==d.state&&(d.__s=j({},d.__s)),j(d.__s,w.getDerivedStateFromProps(m,d.__s))),f=d.props,h=d.state,u)null==w.getDerivedStateFromProps&&null!=d.componentWillMount&&d.componentWillMount(),null!=d.componentDidMount&&d.__h.push(d.componentDidMount);else{if(null==w.getDerivedStateFromProps&&m!==f&&null!=d.componentWillReceiveProps&&d.componentWillReceiveProps(m,b),!d.__e&&null!=d.shouldComponentUpdate&&!1===d.shouldComponentUpdate(m,d.__s,b)||t.__v===n.__v){d.props=m,d.state=d.__s,t.__v!==n.__v&&(d.__d=!1),d.__v=t,t.__e=n.__e,t.__k=n.__k,t.__k.forEach((function(e){e&&(e.__=t)})),d.__h.length&&s.push(d);break e}null!=d.componentWillUpdate&&d.componentWillUpdate(m,d.__s,b),null!=d.componentDidUpdate&&d.__h.push((function(){d.componentDidUpdate(f,h,p)}))}d.context=b,d.props=m,d.state=d.__s,(c=_.__r)&&c(t),d.__d=!1,d.__v=t,d.__P=e,c=d.render(d.props,d.state,d.context),d.state=d.__s,null!=d.getChildContext&&(o=j(j({},o),d.getChildContext())),u||null==d.getSnapshotBeforeUpdate||(p=d.getSnapshotBeforeUpdate(f,h)),y=null!=c&&c.type===E&&null==c.key?c.props.children:c,P(e,Array.isArray(y)?y:[y],t,n,o,i,r,s,a,l),d.base=t.__e,t.__h=null,d.__h.length&&s.push(d),v&&(d.__E=d.__=null),d.__e=!1}else null==r&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=Q(n.__e,t,n,o,i,r,s,l);(c=_.diffed)&&c(t)}catch(e){t.__v=null,(l||null!=r)&&(t.__e=a,t.__h=!!l,r[r.indexOf(a)]=null),_.__e(e,t,n)}}function F(e,t){_.__c&&_.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){_.__e(e,t.__v)}}))}function Q(e,t,n,o,i,r,s,a){var l,c,d,u=n.props,f=t.props,h=t.type,p=0;if("svg"===h&&(i=!0),null!=r)for(;p<r.length;p++)if((l=r[p])&&(l===e||(h?l.localName==h:3==l.nodeType))){e=l,r[p]=null;break}if(null==e){if(null===h)return document.createTextNode(f);e=i?document.createElementNS("http://www.w3.org/2000/svg",h):document.createElement(h,f.is&&f),r=null,a=!1}if(null===h)u===f||a&&e.data===f||(e.data=f);else{if(r=r&&g.call(e.childNodes),c=(u=n.props||S).dangerouslySetInnerHTML,d=f.dangerouslySetInnerHTML,!a){if(null!=r)for(u={},p=0;p<e.attributes.length;p++)u[e.attributes[p].name]=e.attributes[p].value;(d||c)&&(d&&(c&&d.__html==c.__html||d.__html===e.innerHTML)||(e.innerHTML=d&&d.__html||""))}if(function(e,t,n,o,i){var r;for(r in n)"children"===r||"key"===r||r in t||L(e,r,null,n[r],o);for(r in t)i&&"function"!=typeof t[r]||"children"===r||"key"===r||"value"===r||"checked"===r||n[r]===t[r]||L(e,r,t[r],n[r],o)}(e,f,u,i,a),d)t.__k=[];else if(p=t.props.children,P(e,Array.isArray(p)?p:[p],t,n,o,i&&"foreignObject"!==h,r,s,r?r[0]:n.__k&&$(n,0),a),null!=r)for(p=r.length;p--;)null!=r[p]&&C(r[p]);a||("value"in f&&void 0!==(p=f.value)&&(p!==e.value||"progress"===h&&!p)&&L(e,"value",p,u.value,!1),"checked"in f&&void 0!==(p=f.checked)&&p!==e.checked&&L(e,"checked",p,u.checked,!1))}return e}function W(e,t,n){try{"function"==typeof e?e(t):e.current=t}catch(e){_.__e(e,n)}}function G(e,t,n){var o,i;if(_.unmount&&_.unmount(e),(o=e.ref)&&(o.current&&o.current!==e.__e||W(o,null,t)),null!=(o=e.__c)){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(e){_.__e(e,t)}o.base=o.__P=null}if(o=e.__k)for(i=0;i<o.length;i++)o[i]&&G(o[i],t,"function"!=typeof e.type);n||null==e.__e||C(e.__e),e.__e=e.__d=void 0}function V(e,t,n){return this.constructor(e,n)}g=O.slice,_={__e:function(e,t){for(var n,o,i;t=t.__;)if((n=t.__c)&&!n.__)try{if((o=n.constructor)&&null!=o.getDerivedStateFromError&&(n.setState(o.getDerivedStateFromError(e)),i=n.__d),null!=n.componentDidCatch&&(n.componentDidCatch(e),i=n.__d),i)return n.__E=n}catch(t){e=t}throw e}},b=0,U.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=j({},this.state),"function"==typeof e&&(e=e(j({},n),this.props)),e&&j(n,e),null!=e&&this.__v&&(t&&this.__h.push(t),N(this))},U.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),N(this))},U.prototype.render=E,y=[],w="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,I.__r=0,x=0;var J=0;function Y(e,t,n,o,i){var r,s,a={};for(s in t)"ref"==s?r=t[s]:a[s]=t[s];var l={type:e,props:a,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--J,__source:o,__self:i};if("function"==typeof e&&(r=e.defaultProps))for(s in r)void 0===a[s]&&(a[s]=r[s]);return _.vnode&&_.vnode(l),l}function X(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}function Z(){return Y("a",Object.assign({style:"float: right",href:"https://github.com/youdz/d2-stash-organizer","aria-label":"Source code on GitHub",target:"_blank"},{children:Y("svg",Object.assign({style:"fill: white",height:"32",viewBox:"0 0 16 16",version:"1.1",width:"32","aria-hidden":"true"},{children:Y("path",{"fill-rule":"evenodd",d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"},void 0)}),void 0)}),void 0)}X("h1{margin-top:0}.hidden{display:none}.button{appearance:none;background:transparent;border:2px solid;border-color:initial;border-radius:0;box-shadow:none;color:#fff;cursor:pointer;font-family:AvQuest,sans-serif;font-size:16px;font-weight:700;letter-spacing:1px;margin:0;padding:.4em .8em;text-align:initial;text-decoration:none}.magic{color:#6969ff}.rare{color:#ffff64}.unique{color:#c7b377}.set{color:#0f0}.crafted{color:#ffa800}.sidenote,.socketed{color:#787878}.danger{color:#ff6f6f}");var K,ee,te,ne=0,oe=[],ie=_.__b,re=_.__r,se=_.diffed,ae=_.__c,le=_.unmount;function ce(e,t){_.__h&&_.__h(ee,e,ne||t),ne=0;var n=ee.__H||(ee.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function de(e){return ne=1,function(e,t,n){var o=ce(K++,2);return o.t=e,o.__c||(o.__=[n?n(t):ye(void 0,t),function(e){var t=o.t(o.__[0],e);o.__[0]!==t&&(o.__=[t,o.__[1]],o.__c.setState({}))}],o.__c=ee),o.__}(ye,e)}function ue(e,t){var n=ce(K++,3);!_.__s&&be(n.__H,t)&&(n.__=e,n.__H=t,ee.__H.__h.push(n))}function fe(e,t){var n=ce(K++,7);return be(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function he(e,t){return ne=8,fe((function(){return e}),t)}function pe(e){var t=ee.context[e.__c],n=ce(K++,9);return n.c=e,t?(null==n.__&&(n.__=!0,t.sub(ee)),t.props.value):e.__}function ve(){oe.forEach((function(e){if(e.__P)try{e.__H.__h.forEach(ge),e.__H.__h.forEach(_e),e.__H.__h=[]}catch(t){e.__H.__h=[],_.__e(t,e.__v)}})),oe=[]}_.__b=function(e){ee=null,ie&&ie(e)},_.__r=function(e){re&&re(e),K=0;var t=(ee=e.__c).__H;t&&(t.__h.forEach(ge),t.__h.forEach(_e),t.__h=[])},_.diffed=function(e){se&&se(e);var t=e.__c;t&&t.__H&&t.__H.__h.length&&(1!==oe.push(t)&&te===_.requestAnimationFrame||((te=_.requestAnimationFrame)||function(e){var t,n=function(){clearTimeout(o),me&&cancelAnimationFrame(t),setTimeout(e)},o=setTimeout(n,100);me&&(t=requestAnimationFrame(n))})(ve)),ee=void 0},_.__c=function(e,t){t.some((function(e){try{e.__h.forEach(ge),e.__h=e.__h.filter((function(e){return!e.__||_e(e)}))}catch(n){t.some((function(e){e.__h&&(e.__h=[])})),t=[],_.__e(n,e.__v)}})),ae&&ae(e,t)},_.unmount=function(e){le&&le(e);var t=e.__c;if(t&&t.__H)try{t.__H.__.forEach(ge)}catch(e){_.__e(e,t.__v)}};var me="function"==typeof requestAnimationFrame;function ge(e){var t=ee;"function"==typeof e.__c&&e.__c(),ee=t}function _e(e){var t=ee;e.__c=e.__(),ee=t}function be(e,t){return!e||e.length!==t.length||t.some((function(t,n){return t!==e[n]}))}function ye(e,t){return"function"==typeof t?t(e):t}"stream"in Blob.prototype||Object.defineProperty(Blob.prototype,"stream",{value(){return new Response(this).body}}),"setBigUint64"in DataView.prototype||Object.defineProperty(DataView.prototype,"setBigUint64",{value(e,t,n){const o=Number(0xffffffffn&t),i=Number(t>>32n);this.setUint32(e+(n?0:4),o,n),this.setUint32(e+(n?4:0),i,n)}});var we=e=>new DataView(new ArrayBuffer(e)),ke=e=>new Uint8Array(e.buffer||e),xe=e=>Math.min(4294967295,Number(e)),Se=e=>Math.min(65535,Number(e));function Oe(e,t,n){if(void 0===t||t instanceof Uint8Array||(t=Ce(t)),void 0===n||n instanceof Date||(n=new Date(n)),e instanceof File)return{i:t||Ce(e.name),o:n||new Date(e.lastModified),A:e.stream()};if(e instanceof Response){const o=e.headers.get("content-disposition"),i=o&&o.match(/;\s*filename\*?=["']?(.*?)["']?$/i),r=i&&i[1]||new URL(e.url).pathname.split("/").pop(),s=r&&decodeURIComponent(r);return{i:t||Ce(s),o:n||new Date(e.headers.get("Last-Modified")||Date.now()),A:e.body}}if(!t||0===t.length)throw new Error("The file must have a name.");if(void 0===n)n=new Date;else if(isNaN(n))throw new Error("Invalid modification date.");if("string"==typeof e)return{i:t,o:n,A:Ce(e)};if(e instanceof Blob)return{i:t,o:n,A:e.stream()};if(e instanceof Uint8Array||e instanceof ReadableStream)return{i:t,o:n,A:e};if(e instanceof ArrayBuffer||ArrayBuffer.isView(e))return{i:t,o:n,A:ke(e)};if(Symbol.asyncIterator in e)return{i:t,o:n,A:Ae(e)};throw new TypeError("Unsupported input format.")}function Ae(e){const t="next"in e?e:e[Symbol.asyncIterator]();return new ReadableStream({async pull(e){let n=0;for(;e.desiredSize>n;){const o=await t.next();if(!o.value){e.close();break}{const t=je(o.value);e.enqueue(t),n+=t.byteLength}}}})}function je(e){return"string"==typeof e?Ce(e):e instanceof Uint8Array?e:ke(e)}function Ce(e){return(new TextEncoder).encode(String(e))}var qe=new WebAssembly.Instance(new WebAssembly.Module(Uint8Array.from(atob("AGFzbQEAAAABCgJgAABgAn9/AXwDAwIAAQUDAQACBw0DAW0CAAF0AAABYwABCpUBAkkBA38DQCABIQBBACECA0AgAEEBdiAAQQFxQaCG4u1+bHMhACACQQFqIgJBCEcNAAsgAUECdCAANgIAIAFBAWoiAUGAAkcNAAsLSQEBfyABQX9zIQFBgIAEIQJBgIAEIABqIQADQCABQf8BcSACLQAAc0ECdCgCACABQQh2cyEBIAJBAWoiAiAASQ0ACyABQX9zuAs"),(e=>e.charCodeAt(0))))),{t:Ee,c:Ue,m:$e}=qe.exports;Ee();var Me=ke($e).subarray(65536);function Ne(e,t=0){for(const n of function*(e){for(;e.length>65536;)yield e.subarray(0,65536),e=e.subarray(65536);e.length&&(yield e)}(e))Me.set(n),t=Ue(n.length,t);return t}function Ie(e,t,n=0){const o=e.getSeconds()>>1|e.getMinutes()<<5|e.getHours()<<11,i=e.getDate()|e.getMonth()+1<<5|e.getFullYear()-1980<<9;t.setUint16(n,o,1),t.setUint16(n+2,i,1)}function Pe(e){const t=we(30);return t.setUint32(0,1347093252),t.setUint32(4,754976768),Ie(e.o,t,10),t.setUint16(26,e.i.length,1),ke(t)}async function*Be(e){let{A:t}=e;if("then"in t&&(t=await t),t instanceof Uint8Array)yield t,e.u=Ne(t,0),e.l=BigInt(t.length);else{e.l=0n;const n=t.getReader();for(;;){const{value:t,done:o}=await n.read();if(o)break;e.u=Ne(t,e.u),e.l+=BigInt(t.length),yield t}}}function Te(e,t){const n=we(16+(t?8:0));return n.setUint32(0,1347094280),n.setUint32(4,e.u,1),t?(n.setBigUint64(8,e.l,1),n.setBigUint64(16,e.l,1)):(n.setUint32(8,xe(e.l),1),n.setUint32(12,xe(e.l),1)),ke(n)}function De(e,t,n){const o=we(46);return o.setUint32(0,1347092738),o.setUint32(4,755182848),o.setUint16(8,2048),Ie(e.o,o,12),o.setUint32(16,e.u,1),o.setUint32(20,xe(e.l),1),o.setUint32(24,xe(e.l),1),o.setUint16(28,e.i.length,1),o.setUint16(30,n?28:0,1),o.setUint16(40,33204,1),o.setUint32(42,xe(t),1),ke(o)}function Le(e,t){const n=we(28);return n.setUint16(0,1,1),n.setUint16(2,24,1),n.setBigUint64(4,e.l,1),n.setBigUint64(12,e.l,1),n.setBigUint64(20,t,1),ke(n)}function He(o){const i=e[o.code]||t[o.code]||n[o.code];if(!i)throw new Error(`Could not find base ${o.code} for ${o.name}`);return i}const Re=Array(10).fill(0).map(((e,t)=>t)),ze=Array(10).fill(0).map(((e,t)=>t));function Fe(e,t=!1,n=!1){const o=new Map;let i=-1,r=0,s=0,a=0;function l(){i++,r=0,s=0,a=0}let c=!1;for(let d=0;d<e.length;d++){0===d||n?l():(r=a,(c||0<a&&a<3*(3-e.length+d))&&(c=!0,r+=2),s=0,a=r);for(const c of e[d]){const d=He(c);if(s+d[t?"height":"width"]>10&&(r=a,s=0),r+d[t?"width":"height"]>10){if(!n)return Fe(e,t,!0);l()}o.set(c,{page:i,rows:[t?s:r],cols:[t?r:s]}),s+=d[t?"height":"width"],a=Math.max(a,r+d[t?"width":"height"])}!n&&0===d&&e.length>2&&(n=a>3)}return{nbPages:i+1,positions:o}}function Qe(e){return Number(e.code.slice(1))}function We(e,t){switch(e){case"single-line":return function(e){const t=new Map;let n=0;for(const o of e)for(const e of o){const o=He(e);if(n+o.width>10)throw new Error(`Single-line layout ran out of space for ${e.name}`);t.set(e,{page:0,rows:Re,cols:[n]}),n+=o.width}return{nbPages:Math.sign(e.length),positions:t}}(t);case"single-column":return function(e){const t=new Map;let n=0;for(const o of e)for(const e of o){const o=He(e);if(n+o.height>10)throw new Error(`Single-column layout ran out of space for ${e.name}`);t.set(e,{page:0,rows:[n],cols:ze}),n+=o.height}return{nbPages:Math.sign(e.length),positions:t}}(t);case"set":return function([e]){const t=new Map;for(const n of e){const{type:e}=He(n);switch(e){case"ring":t.set(n,{page:0,rows:[6],cols:[3,6]});break;case"amul":t.set(n,{page:0,rows:[2],cols:[6]});break;case"tors":t.set(n,{page:0,rows:[3],cols:[4]});break;case"helm":case"circ":case"phlm":case"pelt":t.set(n,{page:0,rows:[0],cols:[4]});break;case"glov":t.set(n,{page:0,rows:[7],cols:[1]});break;case"belt":t.set(n,{page:0,rows:[7],cols:[4]});break;case"boot":t.set(n,{page:0,rows:[7],cols:[7]});break;case"shie":case"head":case"ashd":t.set(n,{page:0,rows:[2],cols:[7]});break;default:if("7wd"===n.code){t.set(n,{page:0,rows:[2],cols:[7]});break}t.set(n,{page:0,rows:[2],cols:[1]})}}return{nbPages:1,positions:t}}(t);case"runes":return function([e]){const t=new Map;e.sort(((e,t)=>Qe(e)-Qe(t)));const n=[];let o=0;for(let t=1;t<34;t++){const i=[];for(;o<e.length&&Qe(e[o])===t;)i.push(e[o]),o++;n.push(i)}let i=0,r=-2,s=0;function a(e,n){for(const o of e){if(s+1>10&&(r++,s=0),r+1>10&&(i++,r=0,s=0,!n))return a(e,!0);t.set(o,{page:i,rows:[r],cols:[s]}),s++}}for(const e of n)r+=2,s=0,a(e,0===r);return{nbPages:i+1,positions:t}}(t);case"tier-lines":return Fe(t,!1);case"tier-columns":return Fe(t,!0);default:return function(e){const t=new Map;if(0===e.length)return{nbPages:0,positions:t};let n=0,o=0,i=0,r=0;function s(e,a){for(const l of e){const c=He(l);if(i+c.width>10&&(o=r,i=0),o+c.height>10&&(n++,o=0,i=0,r=0,!a))return s(e,!0);t.set(l,{page:n,rows:[o],cols:[i]}),i+=c.width,r=Math.max(r,o+c.height)}}for(const t of e)o=r,i=0,s(t,0===o);return{nbPages:n+1,positions:t}}(t)}}class Ge extends Error{}function Ve(e){const t=function(e){return e.reduce(((e,t)=>e+Ye(t,8)),"")}(e);let n=0;const o={raw:t,read(e,o=n){if(o+e>t.length)throw new Ge;return n=o+e,t.slice(o,o+e)},readInt:(e,t=n)=>Je(o.read(e,t)),readBool:(e=n)=>"1"===o.read(1,e)};return o}function Je(e){return parseInt(e.split("").reverse().join(""),2)}function Ye(e,t){return e.toString(2).padStart(t,"0").split("").reverse().join("")}function Xe(e){const t=[];for(let n=0;n<e.length/8;n++)t.push(Je(e.slice(8*n,8*(n+1))));return t}function Ze(e){return e.personal?e.filename.slice(0,-4):""}function Ke(e,t,n,o,i){for(const n of e.pages){const e=n.items.indexOf(t);if(e>=0){n.items.splice(e,1);break}}if(!e.pages[n])throw new Error("Cannot move an item to a page that has not bee created yet");const r={...t,row:o,column:i},s=e.pages[n].items.find((e=>function(e,t){const{width:n,height:o}=He(e),{width:i,height:r}=He(t);return e.row+o>t.row&&t.row+r>e.row&&e.column+n>t.column&&t.column+i>e.column}(r,e)));if(s)throw new Error(`Trying to move ${t.name} to the same spot as ${s.name}`);e.pages[n].items.push(t),t.character=Ze(e),t.page=n,t.row=o,t.column=i,t.raw=t.raw.slice(0,65)+Ye(i,4)+Ye(o,4)+t.raw.slice(73)}function et(e,t){void 0!==e.flags&&(e.flags+=2,t&&(e.flags+=4))}function tt(e,t,n=!1){return e.sort(((e,o)=>(n?-1:1)*(t(e)-t(o)))).reduce(((e,n)=>{let o=e[e.length-1];return o&&t(o[0])===t(n)||(o=[],e.push(o)),o.push(n),e}),[])}function nt(e,t){const n={name:`# ${t}`,items:[],flags:e.personal?0:1};return e.pages.push(n),n}const ot=["tes","ceh","bet","fed","toa"];function it(e,t){if(0===t.length)return;const n=tt(t,(e=>ot.indexOf(e.code))),o=e.pages.length,{nbPages:i,positions:r}=We("lines",n);for(let t=0;t<i;t++){const n=nt(e,"Respecs");0===t&&et(n,!1)}for(const[t,{page:n,rows:i,cols:s}]of r.entries())Ke(e,t,o+n,i[0],s[0])}const rt=["pk1","pk2","pk3","dhn","bey","mbr","std"];function st(e,t){if(0===t.length)return;const n=tt(t,(e=>rt.indexOf(e.code))),o=e.pages.length,{nbPages:i,positions:r}=We("lines",n);for(let t=0;t<i;t++){const n=nt(e,"Ubers");0===t&&et(n,!1)}for(const[t,{page:n,rows:i,cols:s}]of r.entries())Ke(e,t,o+n,i[0],s[0])}class at extends Error{constructor(e,t){let n=e.name;if(!n)try{n=He(e).name}catch(t){n=`item with code ${e.code}`}n+=` at row ${e.row}, column ${e.column}`;let o=`Failed to parse ${n}`;t&&(o+=`: ${t}`),super(o),this.name="ItemParsingError"}}const lt=["item_armor_percent","armorclass","item_armor_perlevel","item_armorpercent_perlevel"];function ct({readInt:e},t){const n=[];let o=e(9);for(;511!==o;){const i=c[o];if(!i)throw new at(t,`Unknown mod ${o}`);let r={id:o,stat:i.stat,priority:i.descPriority};if(3===i.encode)r={...r,level:e(6)-i.bias,spell:e(10)-i.bias,charges:e(8)-i.bias,maxCharges:e(8)-i.bias};else if(2===i.encode)r={...r,level:e(6)-i.bias,spell:e(10)-i.bias,chance:e(i.size)-i.bias};else{let t;i.paramSize&&(t=e(i.paramSize)-i.bias),r={...r,value:e(i.size)-i.bias,param:t}}n.push(r),lt.includes(r.stat)&&(t.enhancedDefense=!0),"maxdurability"===i.stat&&(t.extraDurability=r.value),o=i.followedBy?i.followedBy:e(9)}return n}function dt(n){const c=Ve(n),d=function({raw:e,readBool:t,readInt:n}){const o={raw:e,identified:t(20),socketed:t(27),simple:t(37),ethereal:t(38),personalized:t(40),runeword:t(42),location:n(3,58),stored:n(3,73),character:"",column:n(4,65),row:n(4,69),code:String.fromCharCode(n(8,76),n(8),n(8),n(8)).trim(),search:""};return o.socketed&&n(3,108)&&(o.filledSockets=[]),(ot.includes(o.code)||rt.includes(o.code))&&(o.simple=!0),o.simple&&(o.name=He(o).name),o}(c);if(!d.simple)try{!function({read:e,readBool:t,readInt:n},c){var d;switch(c.id=n(32,111),c.level=n(7),c.quality=n(4),t()&&(c.picture=n(3)),t()&&(c.classSpecificAffix=n(11)),c.quality){case 2:c.name=He(c).name;break;case 1:c.qualityModifier=n(3),c.name=`Low Quality ${He(c).name}`;break;case 3:c.qualityModifier=n(3),c.name=`Superior ${He(c).name}`;break;case 4:c.prefixes=[n(11)],c.suffixes=[n(11)],c.name=He(c).name,c.prefixes[0]&&(c.name=`${s[c.prefixes[0]].name} ${c.name}`),c.suffixes[0]&&(c.name=`${c.name} ${a[c.suffixes[0]].name}`);break;case 5:c.unique=n(12),c.name=r[c.unique].name;break;case 7:c.unique=n(12),c.name=i[c.unique].name;break;case 6:case 8:c.name=`${o[n(8)]} ${o[n(8)]}`,c.prefixes=[],c.suffixes=[];for(let e=0;e<6;e++)t()&&(null===(d=c[e%2?"suffixes":"prefixes"])||void 0===d||d.push(n(11)))}if(c.runeword&&(c.runewordId=n(12)-27,2691===c.runewordId&&(c.runewordId=21),c.name=l[c.runewordId].name,e(4)),c.personalized){let e,t="";for(;0!==(e=n(7));)t+=String.fromCharCode(e);c.name=`${t}'s ${c.name}`}e(1)}(c,d),function({read:n,readInt:o},i){const r=e[i.code],s=t[i.code];if(r&&(i.defense=o(11)-10),r||s){const e=o(8);e&&(i.durability=[o(8),e],n(1))}(null==s?void 0:s.stackable)&&(i.quantity=o(9)),i.socketed&&(i.sockets=o(4))}(c,d),(d.quality>2||d.runeword)&&function(e,t){t.modifiers=[];const n=5===t.quality?e.read(5):void 0;if(t.runeword&&t.modifiers.push(...ct(e,t)),t.modifiers.push(...ct(e,t)),n){t.setItemModifiers=[];for(let o=0;o<n.length;o++)"1"===n[o]?t.setItemModifiers.push(ct(e,t)):t.setItemModifiers.push([])}}(c,d)}catch(e){if(e instanceof Ge)return!1;if(e instanceof at)throw e;throw new at(d,e.message)}return d}function ut(e){const t=e.readString(2);if("ST"!==t)throw new Error(`Unexpected header ${t} for a stash page`);e.peek=!0,e.readNullTerminatedString(),e.read(1);const n="JM"!==e.readString(2);let o;e.peek=!1,n&&(o=e.readInt8(),e.read(3));const i={flags:o,name:e.readNullTerminatedString(),items:[]};function r(){e.peek=!0;const t=e.done||"ST"===e.readString(2);return e.peek=!1,t}for(e.read(4);!r();){const t=[];let n=!1;for(;!n;)t.push(...e.readUntil(["JM","ST"],2)),n=dt(Uint8Array.from(t));if(6===n.location){const e=i.items[i.items.length-1];if(!e.filledSockets)throw new Error("Trying to socket a non-socketed item");n.socketedIn=e,e.filledSockets.push(n)}else i.items.push(n)}return i}function ft({prop:e,min:t,max:n,param:o},i,r){var s,a;const{stats:l}=u[e];for(const{stat:c,type:u}of l)if("other"===u||"param"===u&&!o){let l=e=>e.stat===c;if("skill"===e)l=e=>"param"in e&&e.param===o&&e.stat===c;else if("skilltab"===e){const e=null===(s=d[Number(o)])||void 0===s?void 0:s.id;l=t=>"param"in t&&t.param===e&&t.stat===c}const u=null==i?void 0:i.find(l);if(("dmg-min"===e||"dmg-max"===e)&&void 0===u)continue;u&&(u.range=[t,n]),r(null!==(a=null==u?void 0:u.value)&&void 0!==a?a:0,t,n)}else if("all"===u){const e=null==i?void 0:i.find((e=>e.stat===c));e&&(e.range=[t,n])}}const ht=["sock"];function pt(e){const t=[];for(const{prop:n,min:o,max:i,param:r}of e){if(ht.includes(n))continue;const{stats:e}=u[n];for(const{stat:s,type:a,param:l}of e){const e=c.findIndex((e=>(null==e?void 0:e.stat)===s));if(e<0)throw new Error(`Unknown mod ${s}`);const u=t[t.length-1],f={id:e,stat:s,priority:c[e].descPriority};switch(a){case"proc":t.push({...f,level:i,spell:Number(r),chance:o});break;case"charges":t.push({...f,level:i,spell:Number(r),charges:o,maxCharges:o});break;case"all":if(!("value"in u))throw new Error("No previous mod to copy");t.push({...f,value:u.value,param:u.param});break;case"min":t.push({...f,value:o});break;case"max":t.push({...f,value:i});break;case"param":t.push({...f,value:Number(r)});break;case"other":if(o!==i)throw new Error(`Unexpected range modifier ${n}: ${o}-${i}`);t.push({...f,value:i,param:r?"item_addskill_tab"===s?d[Number(r)].id:r:l})}}}return t}function vt(t,n){if(t.modifiers||(t.modifiers=[]),"jew"===n.code)t.modifiers.push(...n.modifiers);else{const o=f[n.code];if(!o)throw new at(t,"Only gems, runes and jewels can be put in sockets");const i=e[t.code];let r;r=i?"shie"===i.type||"head"===i.type||"ashd"===i.type?o.shield:o.armor:o.weapon,t.modifiers.push(...pt(r))}}function mt(e,t){return e.id===t.id&&"value"in e&&e.param===t.param}function gt(e,t=c[e.id]){var n,o,i,r,s,a;if(!t)return;let l=e.value;t.stat.endsWith("perlevel")&&(t.stat.includes("tohit")?l/=2:l/=8,l=Math.floor(99*l));let u,f,v,m=(null!=l?l:0)<0?t.descNeg:t.descPos;switch(t.descFunc){case 1:case 6:case 12:u=(null!=l?l:0)<0?`${l}`:`+${l}`;break;case 2:case 7:u=`${l}%`;break;case 3:case 9:u=`${l}`;break;case 4:case 8:u=(null!=l?l:0)<0?`${l}%`:`+${l}%`;break;case 5:u=`${Math.floor(100*l/128)}%`;break;case 11:m=m.replace("%d",""+100/l);break;case 13:m=p[e.param].skillsMod,u=`+${l}`;break;case 14:if(v=d.find((({id:t})=>t===e.param)),!v)throw new Error(`Unknown skill tab ${v}`);m=`+${l} to ${v.name} ${p[v.charClass].classOnly}`;break;case 15:m=m.replace("%d%",`${e.chance}`).replace("%d",`${e.level}`).replace("%s",`${h[e.spell].name}`);break;case 16:m=m.replace("%d",`${l}`).replace("%s",`${h[e.param].name}`);break;case 19:m=m.replace("%d",`${l}`);break;case 20:u=-l+"%";break;case 22:case 23:u=`${l}%`;break;case 24:m=`Level ${e.level} ${h[e.spell].name} ${m.replace("%d",`${e.charges}`).replace("%d",`${e.maxCharges}`)}`;break;case 27:f=h[e.param],m=`+${l} to ${f.name} ${p[f.charClass].classOnly}`;break;case 28:m=`+${l} to ${h[e.param].name}`;break;case 100:(null===(n=e.values)||void 0===n?void 0:n[0])!==(null===(o=e.values)||void 0===o?void 0:o[1])&&(m=t.descNeg),m=m.replace("%d",`${null===(i=e.values)||void 0===i?void 0:i[0]}`).replace("%d",`${null===(r=e.values)||void 0===r?void 0:r[1]}`);break;case 101:m=(null===(s=e.values)||void 0===s?void 0:s[0])===(null===(a=e.values)||void 0===a?void 0:a[1])?m.replace("%d",`${Math.round(e.values[0]*e.values[2]/256)}`).replace("%d",`${Math.round(e.values[2]/25)}`):t.descNeg.replace("%d",`${Math.round(e.values[0]*e.values[2]/256)}`).replace("%d",`${Math.round(e.values[1]*e.values[2]/256)}`).replace("%d",`${Math.round(e.values[2]/25)}`)}if(m){let e="";switch(t.descVal){case 1:e=`${u} ${m}`;break;case 2:e=`${m} ${u}`;break;default:e=m}return 6<=t.descFunc&&t.descFunc<=9&&(e+=` ${t.descAdditional}`),e}}function _t(e,t){var n,o,i;const r=null!==(n=null==t?void 0:t.filter((({id:t})=>e.statsInGroup.includes(t))))&&void 0!==n?n:[];if(r.length!==e.statsInGroup.length)return!1;if(e.allEqual&&r.some((({value:e})=>e!==r[0].value)))return!1;if(e.isRange&&(null!==(o=r[0].value)&&void 0!==o?o:0)>(null!==(i=r[1].value)&&void 0!==i?i:0))return!1;if(("group:secondary-dmg"===e.stat||"group:min-dmg"===e.stat||"group:max-dmg"===e.stat)&&(null==t?void 0:t.find((e=>"group:primary-dmg"===e.stat)))){for(const e of r)delete e.description;return!1}const s={id:-1,stat:e.stat,priority:e.descPriority,value:e.allEqual?r[0].value:void 0,values:r.map((({value:e})=>null!=e?e:0))};s.description=gt(s,e),e.allEqual&&(s.range=r[0].range),null==t||t.push(s);for(const e of r)delete e.description;return!0}function bt(e,t,n=""){for(const e of t)e.description=gt(e),e.description&&n&&(e.description+=n);!function(e){for(const t of v)_t(t,e)}(t),t.sort((({priority:e,param:t},{priority:n,param:o})=>n-e||(null!=o?o:0)-(null!=t?t:0)));for(const{description:n}of t)n&&(e.search+=`${n}\n`)}function yt(e){var t,n;if((e.runeword||7===e.quality||5===e.quality)&&function(e){var t;if(!e.modifiers)return 0;let n,o=e.modifiers;if(e.runeword)n=l[e.runewordId].modifiers;else if(7===e.quality)n=i[e.unique].modifiers;else{if(5!==e.quality)throw new Error("Only uniques, sets and runewords have a perfection score.");n=[...r[e.unique].baseModifiers,...r[e.unique].setModifiers.flat()],o=[...e.modifiers,...e.setItemModifiers.flat()]}n=n.filter((({prop:e})=>"bloody"!==e));const s=He(e);let a=0,c=0;function d(e,t,n){t!==n&&(a=(c*a+(e-t)/(n-t))/++c)}for(const t of n)t.min!==t.max&&("sock"!==t.prop?ft(t,o,d):(e.socketsRange=[t.min,Math.min(t.max,s.maxSockets)],d(e.sockets,...e.socketsRange)));if((7===e.quality||5===e.quality)&&"def"in s&&!n.some((({prop:e})=>"ac%"===e))){const n=null!==(t=e.defense)&&void 0!==t?t:0,o=e.ethereal?1.5:1;e.defenseRange=[Math.floor(s.def[0]*o),Math.floor(s.def[1]*o)],d(n,...e.defenseRange)}e.perfectionScore=0===c?100:Math.floor(100*a)}(e),e.filledSockets)for(const t of e.filledSockets)vt(e,t);if(e.modifiers&&(!function(e){var t,n,o,i,r,s,a,l,c,d,u,f,h,p;for(const v of e){let m;for(;(m=e.findIndex((e=>v!==e&&mt(v,e))))>=0;){const[g]=e.splice(m,1);v.value=(null!==(t=v.value)&&void 0!==t?t:0)+(null!==(n=g.value)&&void 0!==n?n:0),(v.range||g.range)&&(v.range=[(null!==(r=null!==(i=null===(o=v.range)||void 0===o?void 0:o[0])&&void 0!==i?i:v.value)&&void 0!==r?r:0)+(null!==(l=null!==(a=null===(s=g.range)||void 0===s?void 0:s[0])&&void 0!==a?a:g.value)&&void 0!==l?l:0),(null!==(u=null!==(d=null===(c=v.range)||void 0===c?void 0:c[1])&&void 0!==d?d:v.value)&&void 0!==u?u:0)+(null!==(p=null!==(h=null===(f=g.range)||void 0===f?void 0:f[1])&&void 0!==h?h:g.value)&&void 0!==p?p:0)])}}}(e.modifiers),bt(e,e.modifiers)),5===e.quality&&(null===(t=e.setItemModifiers)||void 0===t||t.forEach(((t,n)=>{bt(e,t,` (${n+2} items)`)})),function(e){const t=5===e.quality&&m[r[e.unique].set];t&&(e.setGlobalModifiers=t.modifiers.map((e=>pt(e))))}(e),null===(n=e.setGlobalModifiers)||void 0===n||n.forEach(((t,n)=>{bt(e,t,n>=4?"":` (${n+2} items)`)}))),e.ethereal&&(e.search+="Ethereal\n"),e.sockets&&(e.search+=`Socketed (${e.sockets})\n`),e.filledSockets)for(const t of e.filledSockets)e.search+=`${t.name})\n`;e.search=e.search.toLowerCase()}class wt{constructor(e){this.raw=e,this.peek=!1,this.nextIndex=0}moveTo(e){this.peek||(this.nextIndex=e)}get done(){return this.nextIndex>=this.raw.length}read(e,t=this.nextIndex){return this.moveTo(t+e),this.raw.slice(t,t+e)}readString(e,t=this.nextIndex){return String.fromCharCode(...this.read(e,t))}readUntil(e,t=0,n=this.nextIndex){let o=function(e,t,n=0){const o=[];for(const e of t){if(2!==e.length)throw new Error("indexOf was written for exactly 2-char strings");o.push([e.charCodeAt(0),e.charCodeAt(1)])}for(let t=n;t<e.byteLength-1;t++)for(const[n,i]of o)if(e[t]===n&&e[t+1]===i)return t;return-1}(this.raw,e,n+t);return o<0&&(o=this.raw.length),this.moveTo(o),this.raw.slice(n,o)}readNullTerminatedString(e=this.nextIndex){const t=[];for(;this.raw[e]>0;)t.push(this.raw[e]),e++;return e++,this.moveTo(e),String.fromCharCode(...t)}readInt8(e=this.nextIndex){return this.moveTo(this.nextIndex+1),this.raw[e]}readInt32LE(e=this.nextIndex){return this.moveTo(this.nextIndex+4),this.raw[e]|this.raw[e+1]<<8|this.raw[e+2]<<16|this.raw[e+3]<<24}}function kt(e,t){var n,o,i;const r=new wt(e),s=r.readString(4);if("SSS\0"!==s&&"CSTM"!==s)throw new Error("This does not look like a plugy stash file (.sss or .d2x)");const a={filename:null!==(n=null==t?void 0:t.name)&&void 0!==n?n:"",lastModified:null!==(o=null==t?void 0:t.lastModified)&&void 0!==o?o:0,personal:"CSTM"===s,pageFlags:!0,gold:0,pages:[]};let l=10;const c=r.readString(2);if("01"===c)a.personal&&(l+=4);else{if("02"!==c)throw new Error("Your version of PlugY is too old.");a.gold=r.readInt32LE(),l+=4}for(r.read(0,l);!r.done;)try{a.pages.push(ut(r))}catch(e){if(e instanceof Error)throw new Error(`${e.message} on page ${a.pages.length+1}`)}return a.pageFlags=void 0!==(null===(i=a.pages[0])||void 0===i?void 0:i.flags),function(e){e.pages.forEach((({items:t},n)=>{for(const o of t)o.character=Ze(e),o.page=n,yt(o)}))}(a),a}function xt(e,t,n){for(let o=0;o<t.length;o++)e[n+o]=t.charCodeAt(o);return n+t.length}function St(e,t,n){return e[n]=255&t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24,n+4}function Ot(e,t,n){return e[n]=255&t,e[n+1]=t>>>8,n+2}function At(e){var t;const n=[];let o=0;e.personal?(o=xt(n,"CSTM",o),o=xt(n,"01",o),o+=4):(o=xt(n,"SSS\0",o),o=xt(n,"02",o),o=St(n,e.gold,o)),o=St(n,e.pages.length,o);for(const i of e.pages){o=xt(n,"ST",o),e.pageFlags&&(n[o]=i.flags,o+=4),o=xt(n,i.name,o),o++,o=xt(n,"JM",o),o=Ot(n,i.items.length,o);for(const e of i.items){o=n.push(...Xe(e.raw));for(const i of null!==(t=e.filledSockets)&&void 0!==t?t:[])o=n.push(...Xe(i.raw))}}return Uint8Array.from(n)}window.indexedDB||alert("Your browser doesn't support a stable version of IndexedDB. This application will not remember your stash between sessions.");const jt="save_files",Ct=new Promise(((e,t)=>{const n=indexedDB.open("D2StashOrganizer",2);let o;n.onerror=function(){t("Unable to open IndexedDB")},n.onsuccess=function(){o?o.finally((()=>e(this.result))):e(this.result)},n.onupgradeneeded=function(e){const t=this.result,i=t.createObjectStore(jt,{keyPath:"name"});if(e.oldVersion<1){const e=localStorage.getItem("stash");e&&(i.transaction.oncomplete=()=>{t.transaction(jt,"readwrite").objectStore(jt).add(Ut(JSON.parse(e)))})}else e.oldVersion<2&&(o=new Promise(((e,t)=>{const o=n.transaction.objectStore("stash").get(0);o.onsuccess=function(){if(this.result){const o=n.transaction.objectStore(jt).add(this.result);o.onsuccess=()=>e(),o.onerror=()=>t()}else e()},o.onerror=()=>t()})))}}));function qt(e){return Ct.then((t=>new Promise(((n,o)=>{const i=t.transaction(jt,"readwrite"),r=i.objectStore(jt);r.clear();for(const t of e)r.add(t);i.onerror=function(){o("Unable to save files.")},i.oncomplete=function(){n()}}))))}async function Et(e){try{return kt(new Uint8Array(await e.arrayBuffer()),e)}catch(e){throw e instanceof Error&&alert(e.message),e}}function Ut(e){return new File([new Blob([At(e).buffer])],e.filename||(e.personal?"CharacterName.d2x":"_LOD_SharedStashSave.sss"))}async function $t(){return(await Ct.then((e=>new Promise(((t,n)=>{const o=e.transaction(jt,"readonly").objectStore(jt).getAll();o.onerror=function(){n("Unable to read stash.")},o.onsuccess=function(){t(this.result)}}))))).map((e=>Et(e)))}function Mt(e,t){const n=window.document.createElement("a");n.href=window.URL.createObjectURL(e),n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(n.href)}async function Nt(e){Mt(await(e=>new Response(Ae(async function*(e){const t=[];let n=0n,o=0n,i=0;for await(const r of e){yield Pe(r),yield r.i,yield*Be(r);const e=r.l>=0xffffffffn||n>=0xffffffffn;yield Te(r,e),t.push(De(r,n,e)),t.push(r.i),e&&(t.push(Le(r,n)),n+=8n),o++,n+=BigInt(46+r.i.length)+r.l,i||(i=e)}let r=0n;for(const e of t)yield e,r+=BigInt(e.length);if(i||n>=0xffffffffn){const e=we(76);e.setUint32(0,1347094022),e.setBigUint64(4,BigInt(44),1),e.setUint32(12,755182848),e.setBigUint64(24,o,1),e.setBigUint64(32,o,1),e.setBigUint64(40,r,1),e.setBigUint64(48,n,1),e.setUint32(56,1347094023),e.setBigUint64(64,n+r,1),e.setUint32(72,1,1),yield ke(e)}const s=we(22);s.setUint32(0,1347093766),s.setUint16(8,Se(o),1),s.setUint16(10,Se(o),1),s.setUint32(12,xe(r),1),s.setUint32(16,xe(n),1),yield ke(s)}(async function*(e){for await(const t of e)t instanceof File||t instanceof Response?yield Oe(t):yield Oe(t.input,t.name,t.lastModified)}(e))),{headers:{"Content-Type":"application/zip","Content-Disposition":"attachment"}}))(e).blob(),"D2Save.zip")}function It(e,t=0,n=e.pages.length){const o=[];for(const{items:i}of e.pages.slice(t,n))o.push(...i);return o}const Pt=function(e,t){var n={__c:t="__cC"+x++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e){var n,o;return this.getChildContext||(n=[],(o={})[t]=this,this.getChildContext=function(){return o},this.shouldComponentUpdate=function(e){this.props.value!==e.value&&n.some(N)},this.sub=function(e){n.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){n.splice(n.indexOf(e),1),t&&t.call(e)}}),e.children}};return n.Provider.__=n.Consumer.contextType=n}({characters:new Map,allItems:[],setCollection:()=>{},setSingleStash:()=>{}});function Bt({children:e}){const[t,n]=de({characters:new Map,allItems:[]}),o=he((e=>{const t=new Map(e.map((e=>[Ze(e),{stash:e}])).sort((([e],[t])=>e.localeCompare(t)))),o=e.flatMap((e=>It(e)));n({characters:t,allItems:o})}),[]),i=he((e=>{n((t=>{const n=new Map(t.characters);n.set(Ze(e),{stash:e});const o=Array.from(n.values()).flatMap((({stash:e})=>It(e)));return{characters:n,allItems:o}}))}),[]),r=fe((()=>({...t,setCollection:o,setSingleStash:i})),[t,o,i]);return ue((()=>{$t().then((e=>Promise.all(e).then(o))).catch((()=>{}))}),[o]),Y(Pt.Provider,Object.assign({value:r},{children:e}),void 0)}function Tt(e){if(e.quality&&void 0!==e.unique)switch(e.quality){case 7:return i[e.unique];case 5:return r[e.unique];default:return}}const Dt=[[{name:"Rings",shortName:"rings",types:["ring"],layout:"single-line"},{name:"Amulets",shortName:"amulets",types:["amul"]},{name:"Charms",shortName:"charms",types:["scha","mcha","lcha"],layout:"single-column"},{name:"Jewels",shortName:"jewels",types:["jewl"],layout:"single-line"}],[{name:"Armor",shortName:"armor",types:["tors"]},{name:"Helms",shortName:"helms",types:["helm","circ"]},{name:"Gloves",shortName:"gloves",types:["glov"]},{name:"Belts",shortName:"belts",types:["belt"],layout:"tier-columns"},{name:"Boots",shortName:"boots",types:["boot"]},{name:"Shields",shortName:"shields",types:["shie"]}],[{name:"One-hand axes",shortName:"axes",types:["axe"],twoHanded:!1},{name:"Two-hand axes",shortName:"axes",types:["axe"],twoHanded:!0},{name:"Bows",shortName:"bows",types:["bow"]},{name:"Crossbows",shortName:"crossbows",types:["xbow"]},{name:"Daggers",shortName:"daggers",types:["knif"]},{name:"One-hand maces",shortName:"maces",types:["club","mace","hamm","scep"],twoHanded:!1},{name:"Two-hand maces",shortName:"maces",types:["club","mace","hamm","scep"],twoHanded:!0},{name:"Polearms",shortName:"polearms",types:["pole"]},{name:"Spears",shortName:"spears",types:["spea"]},{name:"Staves",shortName:"staves",types:["staf"]},{name:"One-hand swords",shortName:"swords",types:["swor"],twoHanded:!1},{name:"Two-hand swords",shortName:"swords",types:["swor"],twoHanded:!0},{name:"Throwing",shortName:"throwing",types:["taxe","tkni","jave"]},{name:"Wands",shortName:"wands",types:["wand"]}],[{name:"Amazon",shortName:"Amazon",types:["ajav","abow","aspe"]},{name:"Assassin",shortName:"Assassin",types:["h2h","h2h2"]},{name:"Barbarian",shortName:"Barbarian",types:["phlm"]},{name:"Druid",shortName:"Druid",types:["pelt"]},{name:"Necromancer",shortName:"Necro",types:["head"]},{name:"Paladin",shortName:"Paladin",types:["ashd"]},{name:"Sorceress",shortName:"Sorceress",types:["orb"]}]],Lt=[],Ht=new Map;for(const e of Dt)for(const t of e){Lt.push(...t.types);for(const e of t.types)void 0===t.twoHanded?Ht.set(e,t):Ht.set(`${e}-${Number(t.twoHanded)}`,t)}function Rt(e,t){const n=new Map;for(const e of Dt)for(const t of e)n.set(t,[]);for(const o of e){const e=He(o),i=Ht.get(e.type)||"twoHanded"in e&&Ht.get(`${e.type}-${Number(e.twoHanded)}`);if(!i)continue;const r=n.get(i),s=t?e.tier:0;let a=r[s];a||(a=[],r[s]=a),a.push(o)}for(const[e,t]of n)n.set(e,t.filter((({length:e})=>e>0)));return n}function zt(e){return"enabled"in e||(e=Tt(e)),!!e&&(!He(e).indestructible&&e.modifiers.every((({prop:e})=>"indestruct"!==e&&"ethereal"!==e)))}function Ft(e=!1){let t=i.filter((e=>e.enabled&&e.qlevel>0));e&&(t=t.filter(zt));const n=Rt(t,!0);for(const e of n.values())for(const t of e)t.sort(((e,t)=>e.qlevel-t.qlevel));return n}const Qt=[[{name:"Low level sets",maxLevel:20}],[{name:"Mid level sets",maxLevel:60}],[{name:"High level sets",maxLevel:100}]],Wt=[],Gt=Object.entries(m);let Vt=0;for(const[{maxLevel:e}]of Qt)Wt.push(Gt.filter((([,{levelReq:t}])=>Vt<=t&&t<e)).sort((([,e],[,t])=>e.levelReq-t.levelReq)).map((([e,{name:t}])=>{const n=t.lastIndexOf("'");n>=0&&!t.startsWith("Death")&&!t.startsWith("Heaven")&&!t.startsWith("Orphan")&&(t=t.slice(0,n));let o=t,i=t.indexOf("'",4);return i<0&&(i=t.indexOf(" ",4)),i>0&&(o=t.slice(0,i)),o.startsWith("The ")&&(o=o.slice(4)),{name:t,shortName:o,set:e}}))),Vt=e;function Jt(e){const t=new Map;for(const e of Wt)for(const{set:n}of e)t.set(m[n],[]);for(const n of e){const e="set"in n?n:r[n.unique];t.get(m[e.set]).push(n)}return t}function Yt(e,t){const n=Tt(t);if(n){let o=e.get(n);o||(o=[],e.set(n,o)),o.push(t)}}function Xt(e){const t=new Map;for(const n of e)if(Yt(t,n),n.filledSockets)for(const e of n.filledSockets)Yt(t,e);const n=new Map;for(const[e,o]of Ft())n.set(e,o.map((e=>e.map((e=>{var n,o;return{item:e,normal:!!t.get(e),ethereal:zt(e)?!!(null===(n=t.get(e))||void 0===n?void 0:n.some((({ethereal:e})=>e))):void 0,perfect:!!(null===(o=t.get(e))||void 0===o?void 0:o.some((({perfectionScore:e})=>100===e)))}})))));for(const[e,o]of Jt(r))n.set(e,[o.map((e=>{var n;return{item:e,normal:!!t.get(e),ethereal:void 0,perfect:!!(null===(n=t.get(e))||void 0===n?void 0:n.some((({perfectionScore:e})=>100===e)))}}))]);return n}function Zt(){const{allItems:e}=pe(Pt),{nbNormal:t,totalNormal:n,nbEth:o,totalEth:i,nbPerfect:r}=fe((()=>function(e){const t={nbNormal:0,totalNormal:0,nbEth:0,totalEth:0,nbPerfect:0};for(const n of Xt(e).values())for(const e of n)for(const{normal:n,ethereal:o,perfect:i}of e)t.totalNormal++,n&&t.nbNormal++,i&&t.nbPerfect++,void 0!==o&&(t.totalEth++,o&&t.nbEth++);return t}(e)),[e]);return Y("div",{children:[Y("p",{children:["Normal Grail: ",t," / ",n]},void 0),Y("p",{children:["Eth Grail: ",o," / ",i]},void 0),Y("p",{children:["Perfect Grail: ",r," / ",n]},void 0)]},void 0)}X('.found{color:#6fb76f}.found:after{content:" ✔"}.missing{color:#ff6f6f}.missing:after{content:" ✘"}#grail-tracker{margin-top:1em}#grail-tracker th{text-align:left}#grail-tracker td{padding:0 1em}#grail-tracker td[colspan]{padding-top:1em;text-align:center}');const Kt=["Normal","Exceptional","Elite"],en=e=>e?"found":"missing";function tn(){const{allItems:e}=pe(Pt),[t,n]=de("all"),o=fe((()=>Xt(e)),[e]),i=fe((()=>{const e=[];for(const[n,i]of o)i.forEach(((o,r)=>{const s=[];for(const{item:e,normal:n,ethereal:i,perfect:r}of o)n&&"missing"===t||r&&"perfect"===t||(void 0===i||i)&&"ethereal"===t||s.push(Y("tr",{children:[Y("th",Object.assign({scope:"row",class:"set"in e?"set":"unique"},{children:e.name}),void 0),Y("td",Object.assign({class:en(n)},{children:"Normal"}),void 0),Y("td",void 0===i?{children:Y("span",{"aria-label":"Not applicable"},void 0)}:Object.assign({class:en(i)},{children:"Ethereal"}),void 0),Y("td",Object.assign({class:en(r)},{children:"Perfect"}),void 0)]},void 0));if(0===s.length)return;const a=i.length>1?`${Kt[r]} ${n.name}`:n.name;e.push(Y("tbody",{children:[Y("tr",{children:Y("td",Object.assign({colSpan:4},{children:a}),void 0)},void 0),s]},void 0))}));return e}),[t,o]);return Y(E,{children:[Y("div",Object.assign({class:"controls"},{children:[Y(Zt,{},void 0),Y("div",{children:[Y("p",{children:Y("label",Object.assign({for:"grail-filter"},{children:"Show:"}),void 0)},void 0),Y("p",{children:Y("select",Object.assign({id:"grail-filter",value:t,onChange:({currentTarget:e})=>n(e.value)},{children:[Y("option",Object.assign({value:"all"},{children:"All items"}),void 0),Y("option",Object.assign({value:"missing"},{children:"Missing items"}),void 0),Y("option",Object.assign({value:"ethereal"},{children:"Missing ethereal items"}),void 0),Y("option",Object.assign({value:"perfect"},{children:"Missing perfect items"}),void 0)]}),void 0)},void 0)]},void 0)]}),void 0),Y("table",Object.assign({id:"grail-tracker"},{children:i}),void 0)]},void 0)}function nn({nbEntries:e,pageSize:t,currentEntry:n,onChange:o,entryType:i}){const r=Math.floor((e-1)/t)*t;return ue((()=>{n>=e&&o(0)}),[e,n,o]),Y("div",Object.assign({class:"pagination"},{children:[Y("div",Object.assign({style:{visibility:0===n?"hidden":"visible"}},{children:[Y("button",Object.assign({class:"button",onClick:()=>o(0)},{children:"First"}),void 0),Y("button",Object.assign({class:"button",onClick:()=>o((e=>e-t))},{children:"Previous"}),void 0)]}),void 0),Y("span",{children:[i," ",n+1," -"," ",Math.min(n+t,e)," out of ",e]},void 0),Y("div",Object.assign({style:{visibility:n>=r?"hidden":"visible"}},{children:[Y("button",Object.assign({class:"button",onClick:()=>o((e=>e+t))},{children:"Next"}),void 0),Y("button",Object.assign({class:"button",onClick:()=>o(r)},{children:"Last"}),void 0)]}),void 0)]}),void 0)}function on(e){return e.simple||ot.includes(e.code)||rt.includes(e.code)}function rn({item:e,quantity:t}){var n;const o=[];return on(e)&&o.push(`Quantity: ${t}`),(e.runeword||7===e.quality||5===e.quality)&&(100===e.perfectionScore?o.push("Perfect"):o.push(`${e.perfectionScore}% perfect`)),e.ethereal&&o.push("Ethereal"),e.runeword&&o.push(He(e).name),(null!==(n=e.quality)&&void 0!==n?n:10)<=3&&!e.runeword&&e.sockets&&o.push(`${e.sockets} sockets`),Y(E,{children:o.join(", ")},void 0)}X(".pagination{display:flex;flex-flow:row nowrap;justify-content:space-between;margin:2em 0}.pagination button:first-child{margin-right:1em}.pagination button[disabled]{cursor:default;opacity:0}");X(".item td,.item th{text-align:left}.item th{width:400px}");X(".tooltip-container{position:relative}.tooltip-trigger{cursor:pointer}.tooltip-content{bottom:-1px;height:1px;overflow:hidden;position:fixed;text-align:center;white-space:nowrap;width:1px}.tooltip-container:focus-within .tooltip-content,.tooltip-container:hover .tooltip-content{background:rgba(0,0,0,.9);border:2px solid #fff;bottom:calc(100% + .4em);height:auto;left:0;padding:.4em .8em;position:absolute;width:auto}");let sn=0;function an({range:e}){return e?Y("span",Object.assign({class:"sidenote"},{children:[" [",e.join(" - "),"]"]}),void 0):null}function ln({item:e}){var t,n,o,i,r,s;const[a]=de((()=>"item-tooltip-"+sn++)),l=function(e){if(e.runeword)return"unique";switch(e.quality){case 4:return"magic";case 6:return"rare";case 7:return"unique";case 5:return"set";case 8:return"crafted"}return e.sockets||e.ethereal?"socketed":""}(e);if(e.simple)return Y("span",Object.assign({class:l},{children:e.name}),void 0);const c=He(e),d=null!==(n=null===(t=e.modifiers)||void 0===t?void 0:t.map((({description:e,range:t})=>e&&Y("div",Object.assign({class:"magic"},{children:[e,Y(an,{range:t},void 0)]}),void 0))))&&void 0!==n?n:[];if(e.ethereal||e.sockets){const t=[e.ethereal&&"Ethereal",e.sockets&&`Socketed (${e.sockets})`].filter((e=>!!e));null==d||d.push(Y("div",Object.assign({class:"magic"},{children:[t.join(", "),Y(an,{range:e.socketsRange},void 0)]}),void 0))}const u=null===(o=e.setItemModifiers)||void 0===o?void 0:o.flatMap((e=>e.map((({description:e,range:t})=>e&&Y("div",Object.assign({class:"set"},{children:[e," ",Y(an,{range:t},void 0)]}),void 0))))),f=null===(i=e.setGlobalModifiers)||void 0===i?void 0:i.flatMap((e=>e.map((({description:e})=>e&&Y("div",Object.assign({class:"unique"},{children:e}),void 0)))));return null==f||f.unshift(Y("br",{},void 0)),Y("span",Object.assign({class:"tooltip-container"},{children:[Y("span",Object.assign({class:`tooltip-trigger ${l}`,tabIndex:0,"aria-describedby":a},{children:e.name}),void 0),Y("div",Object.assign({id:a,class:"tooltip-content",role:"tooltip"},{children:[Y("div",Object.assign({class:l},{children:e.name}),void 0),Y("div",Object.assign({class:l},{children:null==c?void 0:c.name}),void 0),Y("div",{children:["Item Level: ",e.level]},void 0),"def"in c&&Y("div",{children:["Defense:"," ",Y("span",Object.assign({class:e.enhancedDefense?"magic":""},{children:[e.defense,Y(an,{range:e.defenseRange},void 0)]}),void 0)]},void 0),e.durability&&Y("div",{children:["Durability: ",null===(r=e.durability)||void 0===r?void 0:r[0]," of"," ",e.durability[1]+(null!==(s=e.extraDurability)&&void 0!==s?s:0)]},void 0),d,u,f]}),void 0)]}),void 0)}function cn({item:e}){let t="",n="";return 0===e.location&&5===e.stored?(t=e.character?`${e.character}'s stash`:"Shared stash",void 0!==e.page&&(n=`, page ${e.page+1}`)):t="Unknown location",Y(E,{children:[t,n]},void 0)}function dn({item:e,quantity:t,withLocation:n}){return Y("tr",Object.assign({class:"item"},{children:[Y("th",Object.assign({scope:"row"},{children:Y(ln,{item:e},void 0)}),void 0),Y("td",{children:Y(rn,{item:e,quantity:t},void 0)},void 0),n&&Y("td",{children:Y(cn,{item:e},void 0)},void 0)]}),void 0)}X(".page-title{border-bottom:1px solid #666;display:flex;flex-flow:row;justify-content:space-between}.page{table-layout:fixed;width:100%}");function un(e){return e.name||(void 0!==e.flags&&e.flags%2?"Shared Page #":"Personal Page #")}function fn(e){const t=new Map;let n=0;for(const o of e)if(on(o)){let e=t.get(o.code);e?0!==e.item.location&&0===o.location&&(e.item=o):(e={item:o,quantity:0},t.set(o.code,e)),e.quantity++}else t.set(""+n++,{item:o,quantity:1});return Array.from(t.values())}function hn({page:e,index:t}){var n,o;const i=(null!==(n=e.flags)&&void 0!==n?n:0)>=4?"Main index":(null!==(o=e.flags)&&void 0!==o?o:0)>=2?"Index":"",r=fe((()=>fn(e.items)),[e.items]);return Y("section",{children:[Y("h3",Object.assign({class:"page-title"},{children:[Y("span",{children:un(e).replace("#",`${t+1}`)},void 0),Y("span",{children:i},void 0)]}),void 0),Y("table",Object.assign({class:"page"},{children:Array.from(r.values()).map((({item:e,quantity:t},n)=>{var o;return Y(dn,{item:e,quantity:t,withLocation:!1},null!==(o=e.id)&&void 0!==o?o:n)}))}),void 0)]},void 0)}function pn({value:e,onChange:t,children:n}){return Y("div",{children:[Y("p",{children:Y("label",Object.assign({for:"search-input"},{children:n}),void 0)},void 0),Y("p",{children:Y("input",{id:"search-input",type:"search",value:e,onInput:({currentTarget:e})=>t(e.value)},void 0)},void 0)]},void 0)}function vn(e,t,n){if(!t)return e;const o=t.toLocaleLowerCase().split(/"([^"]*)"|\s+/).filter(Boolean);return e.filter((e=>{const t=He(e);return o.every((o=>{var i;return(null==n?void 0:n.toLocaleLowerCase().includes(o))||(null===(i=e.name)||void 0===i?void 0:i.toLocaleLowerCase().includes(o))||t.name.toLocaleLowerCase().includes(o)||e.search.includes(o)}))}))}function mn({value:e,onChange:t}){return Y("div",{children:[Y("p",{children:Y("label",Object.assign({for:"quality-select"},{children:"Filter by quality:"}),void 0)},void 0),Y("p",{children:Y("select",Object.assign({id:"quality-select",value:e,onChange:({currentTarget:e})=>t(e.value)},{children:[Y("option",Object.assign({value:"all"},{children:"All"}),void 0),Y("option",Object.assign({value:"normal"},{children:"Non-magical"}),void 0),Y("option",Object.assign({value:"superior"},{children:"Superior"}),void 0),Y("option",Object.assign({value:"magic"},{children:"Magic"}),void 0),Y("option",Object.assign({value:"rare"},{children:"Rare"}),void 0),Y("option",Object.assign({value:"unique"},{children:"Unique"}),void 0),Y("option",Object.assign({value:"set"},{children:"Set"}),void 0),Y("option",Object.assign({value:"runeword"},{children:"Rune word"}),void 0),Y("option",Object.assign({value:"crafted"},{children:"Crafted"}),void 0),Y("option",Object.assign({value:"misc"},{children:"Non-equipment"}),void 0)]}),void 0)},void 0)]},void 0)}function gn(e,t){return"all"===t?e:e.filter((e=>{var n;switch(t){case"normal":return(null!==(n=e.quality)&&void 0!==n?n:10)<=3&&!e.runeword;case"superior":return 3===e.quality&&!e.runeword;case"magic":return 4===e.quality;case"rare":return 6===e.quality;case"unique":return 7===e.quality;case"set":return 5===e.quality;case"runeword":return e.runeword;case"crafted":return 8===e.quality;case"misc":return e.simple}}))}X(".controls{align-items:stretch;border-bottom:1px solid #666;display:flex;flex-flow:row nowrap;padding:1em 0}.controls>:not(:last-child){border-right:1px solid #666;padding-right:2em}.controls>:not(:first-child){padding-left:2em}.controls p:first-child{margin-top:0}.controls p:last-child{margin-bottom:0}.controls input,.controls select{width:100%}");function _n(){const{characters:e}=pe(Pt),[t,n]=de(""),[o,i]=de(""),[r,s]=de("all"),[a,l]=de(0),c=fe((()=>{var n;return null===(n=e.get(t))||void 0===n?void 0:n.stash}),[e,t]),d=fe((()=>null==c?void 0:c.pages.map(((e,t)=>({...e,name:un(e).replace("#",`${t+1}`),items:gn(vn(e.items,o,e.name),r)}))).filter((({items:e})=>e.length>0))),[c,o,r]);ue((()=>{l(0)}),[c]);const u=fe((()=>{const t=[];for(const n of e.keys())t.push(Y("option",Object.assign({value:n},{children:n||"Shared stash"}),void 0));return t}),[e]);if(!d)return null;const f=Y(nn,{nbEntries:d.length,pageSize:10,currentEntry:a,onChange:l,entryType:"Pages"},void 0);return Y(E,{children:[Y("div",Object.assign({class:"controls"},{children:[Y("div",{children:[Y("p",{children:Y("label",Object.assign({for:"character-select"},{children:"Select a character:"}),void 0)},void 0),Y("p",{children:Y("select",Object.assign({id:"character-select",value:t,onChange:({currentTarget:e})=>n(e.value)},{children:u}),void 0)},void 0)]},void 0),Y(pn,Object.assign({value:o,onChange:i},{children:"Search for an item or a page:"}),void 0),Y(mn,{value:r,onChange:s},void 0)]}),void 0),f,Y("div",{children:d.slice(a,a+10).map(((e,t)=>Y(hn,{page:e,index:t+a},t)))},void 0),f]},void 0)}function bn(e,t,n=e.pages.length){const o=e.pages.splice(t,n-t),i=[];for(const{items:e}of o)i.push(...e);return i}X("#navigation{border-bottom:1px solid #666;display:flex;flex-flow:row nowrap}.nav-link{color:#aaa;margin:0 1em;padding-bottom:.4em;text-decoration:none}.nav-link.active{border-bottom:1px solid #fff;color:#fff;margin-bottom:-1px}");const yn=["unknown","rejuvs","respecs","ubers","gems","runes","runewords","uniques","sets"];function wn(n){var o;const i=He(n);return"rpot"===i.type?"rejuvs":ot.includes(n.code)?"respecs":rt.includes(n.code)?"ubers":i.type.startsWith("gem")?"gems":"rune"===i.type?"runes":(null!==(o=n.quality)&&void 0!==o?o:10)<=3&&(n.code in e||n.code in t)?"runewords":5===n.quality?"sets":Lt.includes(i.type)?"uniques":"unknown"}function kn(e,t){if(0===t.length)return;const n=e.pages.length,{nbPages:o,positions:i}=We("lines",[t]);for(let t=0;t<o;t++){const n=nt(e,"Unrecognized");0===t&&et(n,!0)}for(const[t,{page:o,rows:r,cols:s}]of i.entries())Ke(e,t,n+o,r[0],s[0])}function xn(e,t){return e.code.localeCompare(t.code)}function Sn(e,t){if(0===t.length)return;t.sort(xn);const n=e.pages.length,{nbPages:o,positions:i}=We("lines",[t]);for(let t=0;t<o;t++){const n=nt(e,"Rejuvs");0===t&&et(n,!0)}for(const[t,{page:o,rows:r,cols:s}]of i.entries())Ke(e,t,n+o,r[0],s[0])}const On=["gsy","gsv","gsb","gsr","gsg","gsw","sku"],An=On.map((e=>n[e].type)),jn=On.map((e=>n[e].name)),Cn=["c","f","u","s","l","z","p"];function qn(e,t){if(0===t.length)return;const o=On.map((()=>[]));for(const e of t)o[An.indexOf(n[e.code].type)].push(e);const i=o.map(((e,t)=>tt(e,function(e=!1){return t=>Cn.indexOf(t.code.charAt(e?2:1))}(6===t))));let r=e.pages.length;for(let t=0;t<o.length;t++){const{nbPages:n,positions:o}=We("lines",i[t]);for(let o=0;o<n;o++){const n=nt(e,jn[t]);0===o&&et(n,0===t)}for(const[t,{page:n,rows:i,cols:s}]of o.entries())Ke(e,t,r+n,i[0],s[0]);r+=n}}function En(e,t){const n=e.pages.length,{nbPages:o,positions:i}=We("runes",[t]);for(let t=0;t<o;t++){const n=nt(e,"Runes");0===t&&et(n,!0)}for(const[t,{page:o,rows:r,cols:s}]of i.entries())Ke(e,t,n+o,r[0],s[0])}function Un(e,t){return l[e.runewordId].levelReq-l[t.runewordId].levelReq}function $n(e,t){var n,o,i,r;const s=He(e),a=He(t);return Lt.indexOf(s.type)-Lt.indexOf(a.type)||a.qlevel-s.qlevel||(null!==(n=t.sockets)&&void 0!==n?n:0)-(null!==(o=e.sockets)&&void 0!==o?o:0)||(null!==(i=t.quality)&&void 0!==i?i:0)-(null!==(r=e.quality)&&void 0!==r?r:0)}function Mn(e,t){if(0===t.length)return;const n=[],o=[];for(const e of t)e.runeword?n.push(e):o.push(e);n.sort(Un),o.sort($n);let i=e.pages.length;[["Runewords",n],["Bases",o]].forEach((([t,n],o)=>{const{nbPages:r,positions:s}=We("lines",[n]);for(let n=0;n<r;n++){const i=nt(e,t);0===n&&et(i,0===o)}for(const[t,{page:n,rows:o,cols:r}]of s.entries())Ke(e,t,i+n,o[0],r[0]);i+=r}))}function Nn(e,t,{positions:n},o){var i;const r=new Map,s=[];for(const a of t){const t=Tt(a);if(!t){s.push(a);continue}const l=null!==(i=r.get(t))&&void 0!==i?i:0,c=n.get(t);if(!c)throw new Error(`Unknown position for grail item ${t.name}`);const{page:d,rows:u,cols:f}=c;l>=u.length*f.length?s.push(a):(Ke(e,a,d+o,u[l%u.length],f[Math.floor(l/u.length)]),r.set(t,l+1))}return s}function In(e,t){return Lt.indexOf(He(e).type)-Lt.indexOf(He(t).type)}function Pn(e,t){const n=Jt(t),o=function(){const e=Jt(r),t=new Map;for(const[n,o]of e)t.set(n,We("set",[o]));return t}();let i=e.pages.length;for(const t of Wt)t.forEach((({name:t,shortName:r,set:s},a)=>{et(nt(e,t),0===a);const l=Nn(e,n.get(m[s]),o.get(m[s]),i);if(i++,l.length>0){l.sort(In);const{nbPages:t,positions:n}=We("lines",[l]);for(let n=0;n<t;n++)nt(e,`Extra ${r}`);for(const[t,{page:o,rows:r,cols:s}]of n.entries())Ke(e,t,i+o,r[0],s[0]);i+=t}}))}function Bn(e){var t;const n=Ft(e),o=new Map;for(const[e,i]of n)o.set(e,We(null!==(t=e.layout)&&void 0!==t?t:"tier-lines",i));return o}function Tn(e,t){var n,o;const r=He(e),s=He(t);return(null!==(n=t.quality)&&void 0!==n?n:0)-(null!==(o=e.quality)&&void 0!==o?o:0)||s.qlevel-r.qlevel||(t.unique?i[t.unique].qlevel:0)-(e.unique?i[e.unique].qlevel:0)}function Dn(e,t){const n=Rt(t,!1),o=Bn(!1),i=Bn(!0);let r=e.pages.length;for(const t of Dt)t.forEach(((t,s)=>{var a,l,c;const{name:d,shortName:u}=t,f=o.get(t),h=i.get(t);if(!f)throw new Error(`No template for ${d}`);for(let t=0;t<f.nbPages;t++){const n=nt(e,d);0===t&&et(n,0===s)}for(let t=0;t<(null!==(a=null==h?void 0:h.nbPages)&&void 0!==a?a:0);t++)nt(e,`Eth ${u}`);const p=null===(l=n.get(t))||void 0===l?void 0:l[0];if(!p)return void(r+=f.nbPages+(null!==(c=null==h?void 0:h.nbPages)&&void 0!==c?c:0));null==p||p.sort(((e,t)=>Number(e.ethereal)-Number(t.ethereal)));let v=Nn(e,p,f,r);if(r+=f.nbPages,h){const t=v.filter((e=>!e.ethereal||!zt(e)));t.push(...Nn(e,v.filter((e=>e.ethereal&&zt(e))),h,r)),v=t,r+=h.nbPages}if(v.length>0){v.sort(Tn);const t=v.reduce(((e,t)=>{var n,o;let i=e.length-1;return(null===(o=null===(n=e[i])||void 0===n?void 0:n[0])||void 0===o?void 0:o.quality)!==t.quality&&(i=e.push([])-1),e[i].push(t),e}),[]),{nbPages:n,positions:o}=We("lines",t);for(let t=0;t<n;t++)nt(e,`Extra ${u}`);for(const[t,{page:n,rows:i,cols:s}]of o.entries())Ke(e,t,r+n,i[0],s[0]);r+=n}}))}function Ln(e){let t=e.length;for(const n of e)n.filledSockets&&(t+=n.filledSockets.length);return t}function Hn(e,t=[],n=0,o=0){const i=Ln(It(e))+Ln(t),r=bn(e,n);r.push(...t);for(let t=0;t<o;t++)nt(e,"Misc");const s=function(e){const t=new Map(yn.map((e=>[e,[]])));for(const n of e)t.get(wn(n)).push(n);return t}(r);for(const t of yn){const n=s.get(t);if(n)switch(t){case"unknown":kn(e,n);break;case"rejuvs":Sn(e,n);break;case"respecs":it(e,n);break;case"ubers":st(e,n);break;case"gems":qn(e,n);break;case"runes":En(e,n);break;case"runewords":Mn(e,n);break;case"sets":Pn(e,n);break;case"uniques":Dn(e,n);break;default:throw new Error("Unknown section sectionId")}}if(Ln(It(e))!==i)throw new Error("Lost items in the process, cancelling")}function Rn({href:e,children:t}){return Y("a",Object.assign({href:e,target:"_blank"},{children:[t," ",Y("svg",Object.assign({class:"external-link-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},{children:[Y("title",{children:"(opens in new tab)"},void 0),Y("path",{fill:"currentColor",d:"M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"},void 0)]}),void 0)]}),void 0)}X(".external-link-icon{display:inline-block;height:.6em}");X("#organizer li{margin-bottom:1em}#sources-selector{list-style:none;padding:0}#sources-selector li{margin-bottom:.4em}#organizer .button.danger{margin-left:1em}");function zn(e){return function(t){e(Number(t.target.value))}}function Fn({sources:e,setSources:t,target:n}){const{characters:o}=pe(Pt),i=he(((e,n)=>{t((t=>{var o,i,r;return{...t,[e]:{selected:void 0===n?!(null===(o=t[e])||void 0===o?void 0:o.selected):n,skipPages:null!==(r=null===(i=t[e])||void 0===i?void 0:i.skipPages)&&void 0!==r?r:0}}}))}),[t]);return ue((()=>{var t;(null===(t=e[n])||void 0===t?void 0:t.selected)||i(n,!0)}),[e,n,i]),Y(E,{children:["Take all items from:",Y("ul",Object.assign({id:"sources-selector"},{children:Array.from(o.keys()).map((o=>{var r,s,a;return Y("li",{children:[Y("label",{children:[Y("input",{type:"checkbox",checked:!!(null===(r=e[o])||void 0===r?void 0:r.selected),disabled:o===n,onChange:()=>i(o)},void 0)," ",o?Y(E,{children:[Y("span",Object.assign({class:"unique"},{children:o}),void 0),"'s stash"]},void 0):Y("span",Object.assign({class:"magic"},{children:"Shared stash"}),void 0)]},void 0),", except the first"," ",Y("input",{type:"number",min:0,max:99,value:null!==(a=null===(s=e[o])||void 0===s?void 0:s.skipPages)&&void 0!==a?a:0,onChange:zn((e=>t((t=>{var n;return{...t,[o]:{selected:!!(null===(n=t[o])||void 0===n?void 0:n.selected),skipPages:e}}}))))},void 0)," ","pages."]},void 0)}))}),void 0)]},void 0)}function Qn({target:e,setTarget:t,emptyPages:n,setEmptyPages:o}){const{characters:i}=pe(Pt);return Y(E,{children:["Move them to"," ",Y("select",Object.assign({id:"character-select",value:e,onChange:({currentTarget:e})=>t(e.value)},{children:Array.from(i.keys()).map((e=>Y("option",Object.assign({value:e},{children:e?`${e}'s stash`:"Shared stash"}),void 0)))}),void 0),", leaving"," ",Y("input",{type:"number",min:0,max:99,value:n,onChange:zn(o)},void 0)," ","empty page",1===n?"":"s"," at the start"]},void 0)}function Wn(){var e,t;const{characters:n,setCollection:o}=pe(Pt),[i,r]=de({"":{selected:!0,skipPages:1}}),[s,a]=de(""),[l,c]=de(0),d=null===(e=n.get(s))||void 0===e?void 0:e.stash,u=he((async e=>{var t,r,a,c;if(d)try{const u=[];if(!e)for(const[e,{stash:o}]of n.entries())e!==s&&(null===(t=i[e])||void 0===t?void 0:t.selected)&&u.push(...bn(o,null!==(a=null===(r=i[e])||void 0===r?void 0:r.skipPages)&&void 0!==a?a:0));Hn(d,u,null===(c=i[s])||void 0===c?void 0:c.skipPages,l);const f=[];let h;for(const[e,{stash:t}]of n.entries()){const n=Ut(t);f.push(n),e===s&&(h=n)}await qt(f),o(Array.from(n.values()).map((({stash:e})=>e))),e&&h?Mt(h,h.name):await Nt(f)}catch(e){throw e instanceof Error&&alert(e.message),e}}),[n,l,o,i,s,d]);if(!n.has(""))return Y("p",{children:["This feature requires"," ",Y(Rn,Object.assign({href:"http://plugy.free.fr/"},{children:"PlugY's extended stash"}),void 0),". It allows you to organize your collection across hundreds of pages in just one click, whether in the shared stash or in a character's personal stash."]},void 0);const f=Object.values(i).filter((e=>null==e?void 0:e.selected)).length;return Y("ol",Object.assign({id:"organizer"},{children:[Y("li",{children:Y(Fn,{sources:i,setSources:r,target:s},void 0)},void 0),Y("li",{children:Y(Qn,{target:s,setTarget:a,emptyPages:l,setEmptyPages:c},void 0)},void 0),Y("li",{children:"Organize the items for me"},void 0),Y("li",{children:[Y("button",Object.assign({class:"button",disabled:!d,onClick:()=>u()},{children:"Download updated save files"}),void 0),d&&1===f&&(null===(t=i[s])||void 0===t?void 0:t.selected)&&Y("button",Object.assign({class:"button danger",onClick:()=>window.confirm("Downloading a single stash at a time is not recommended, because you risk losing items that were moved between characters since the last upload or download.\n\nAre you sure you want to proceed?")&&u(!0)},{children:"Download a single stash"}),void 0)]},void 0)]}),void 0)}function Gn(){const{allItems:e}=pe(Pt),[t,n]=de(""),[o,i]=de("all"),[r,s]=de(20),[a,l]=de(0),c=fe((()=>gn(vn(e,t),o)),[e,t,o]),d=fe((()=>fn(c)),[c]);return ue((()=>{l(0)}),[e]),Y(E,{children:[Y("div",Object.assign({class:"controls"},{children:[Y(pn,Object.assign({value:t,onChange:n},{children:"Search for an item:"}),void 0),Y(mn,{value:o,onChange:i},void 0),Y("div",{children:[Y("p",{children:Y("label",Object.assign({for:"page-size-select"},{children:"Items per page:"}),void 0)},void 0),Y("p",{children:Y("select",Object.assign({id:"page-size-select",value:r,onChange:({currentTarget:e})=>s(Number(e.value))},{children:[Y("option",Object.assign({value:10},{children:"10"}),void 0),Y("option",Object.assign({value:20},{children:"20"}),void 0),Y("option",Object.assign({value:50},{children:"50"}),void 0),Y("option",Object.assign({value:100},{children:"100"}),void 0)]}),void 0)},void 0)]},void 0)]}),void 0),Y(nn,{nbEntries:d.length,pageSize:r,currentEntry:a,onChange:l,entryType:"Items"},void 0),Y("table",Object.assign({id:"collection"},{children:[Y("thead",{children:Y("tr",Object.assign({class:"sidenote"},{children:[Y("th",{children:"Item"},void 0),Y("th",{children:"Characteristics"},void 0),Y("th",{children:"Location"},void 0)]}),void 0)},void 0),Y("tbody",{children:d.slice(a,a+r).map((({item:e,quantity:t},n)=>{var o;return Y(dn,{item:e,quantity:t,withLocation:!0},null!==(o=e.id)&&void 0!==o?o:n)}))},void 0)]}),void 0)]},void 0)}function Vn({folder:e,children:t}){const{setCollection:n,setSingleStash:o}=pe(Pt),i=function(e){return ne=5,fe((function(){return{current:e}}),[])}(null),r=he((async()=>{var t,r;if(null===(t=i.current)||void 0===t?void 0:t.files){const t=[];for(const e of i.current.files)e.webkitRelativePath.split("/").length>2||(e.name.endsWith(".sss")||e.name.endsWith(".d2x"))&&t.push(e);if(e)await qt(t),n(await Promise.all(t.map((e=>Et(e)))));else{const e=t[0];await(r=e,Ct.then((e=>new Promise(((t,n)=>{const o=e.transaction(jt,"readwrite").objectStore(jt).put(r);o.onerror=function(){n("Unable to save stash.")},o.onsuccess=function(){t()}}))))),o(await Et(e))}i.current.value=""}}),[e,n,o]),s=e?{directory:!0,webkitdirectory:!0,multiple:!0}:{accept:".sss,.d2x"};return Y("span",Object.assign({class:"filepicker"},{children:[Y("button",Object.assign({class:e?"button":"button danger",onClick:()=>{var e;return null===(e=i.current)||void 0===e?void 0:e.click()}},{children:t}),void 0),Y("input",Object.assign({class:"hidden",ref:i,type:"file"},s,{onChange:r}),void 0)]}),void 0)}X("#collection{border-collapse:collapse;width:100%}#collection thead th{padding-bottom:.4em}#collection .item td{padding:0 2em}#collection tbody .item th{padding-top:.3em}#collection tr{border-bottom:1px solid #222}#collection tbody tr:hover td:not(:first-child){color:#6fb76f}");X("#save-files{border-collapse:collapse}#save-files td,#save-files th{border:1px solid #666;padding:.4em 1em}.filepicker:first-child{margin-right:1em}");const Jn=Intl.DateTimeFormat(void 0,{dateStyle:"long",timeStyle:"medium"});function Yn(){const{characters:e}=pe(Pt),[t,n]=de(!1),o=fe((()=>{const t=[];for(const[n,{stash:o}]of e.entries())t.push(Y("tr",{children:[Y("td",Object.assign({class:n?"unique":"magic"},{children:n||"Shared stash"}),void 0),Y("td",{children:Jn.format(new Date(o.lastModified))},void 0)]},void 0));return t}),[e]);return Y(E,{children:[Y("p",Object.assign({class:"sidenote"},{children:"Simply select your Diablo 2 save folder, and this tool will detect all items on every character and in every stash."}),void 0),Y("p",{children:[Y(Vn,Object.assign({folder:!0},{children:[0===e.size?"Upload":"Refresh"," all my save files"]}),void 0),!t&&Y("button",Object.assign({class:"button sidenote",onClick:()=>window.confirm("Uploading a single stash at a time is not recommended, as you might run into inconsistencies if you have moved items between characters, and even risk losing items with the Organize feature.\n\nAre you sure you want to proceed?")&&n(!0)},{children:"Let me select a single file"}),void 0),t&&Y(Vn,Object.assign({folder:!1},{children:[0===e.size?"Upload":"Update"," a single stash"]}),void 0)]},void 0),Y("table",Object.assign({id:"save-files"},{children:[Y("tr",{children:[Y("th",{children:"Character name"},void 0),Y("th",{children:"Save date"},void 0)]},void 0),o]}),void 0)]},void 0)}function Xn({hash:e,isHome:t,children:n}){const o=location.hash===e||t&&""===location.hash;return Y("a",Object.assign({class:o?"nav-link active":"nav-link",href:e},{children:n}),void 0)}function Zn(){const[e,t]=de(location.hash);ue((()=>{const e=()=>t(location.hash);return window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)}),[]);const n=fe((()=>{switch(e){case"#collection":return Y(Gn,{},void 0);case"#stash":return Y(_n,{},void 0);case"#organize":return Y(Wn,{},void 0);case"#grail-tracker":return Y(tn,{},void 0);default:return Y(Yn,{},void 0)}}),[e]);return Y(E,{children:[Y("nav",Object.assign({id:"navigation"},{children:[Y(Xn,Object.assign({hash:"#saves",isHome:!0},{children:"Save files"}),void 0),Y(Xn,Object.assign({hash:"#collection"},{children:"Collection"}),void 0),Y(Xn,Object.assign({hash:"#stash"},{children:"Stashes"}),void 0),Y(Xn,Object.assign({hash:"#organize"},{children:"Organize"}),void 0),Y(Xn,Object.assign({hash:"#grail-tracker"},{children:"Grail tracker"}),void 0)]}),void 0),n]},void 0)}function Kn(){return Y("div",Object.assign({id:"app"},{children:Y(Bt,{children:[Y(Z,{},void 0),Y("h1",{children:"Diablo 2 Item Manager"},void 0),Y(Zn,{},void 0)]},void 0)}),void 0)}!function(e,t,n){var o,i,r;_.__&&_.__(e,t),i=(o="function"==typeof n)?null:n&&n.__k||t.__k,r=[],z(t,e=(!o&&n||t).__k=function(e,t,n){var o,i,r,s={};for(r in t)"key"==r?o=t[r]:"ref"==r?i=t[r]:s[r]=t[r];if(arguments.length>2&&(s.children=arguments.length>3?g.call(arguments,2):n),"function"==typeof e&&null!=e.defaultProps)for(r in e.defaultProps)void 0===s[r]&&(s[r]=e.defaultProps[r]);return q(e,s,o,i,null)}(E,null,[e]),i||S,S,void 0!==t.ownerSVGElement,!o&&n?[n]:i?null:t.firstChild?g.call(t.childNodes):null,r,!o&&n?n:i?i.__e:t.firstChild,o),F(r,e)}(Y(Kn,{},void 0),document.body,document.getElementById("app"));export{Kn as App};
