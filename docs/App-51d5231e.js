import{I as e,A as t,W as n,M as i,R as o,U as r,S as s,a,b as l,c,d,P as u,G as h,e as f,C as p,f as v,g as m}from"./game-data-b97d1a5d.js";var g,_,b,y,w,k,x,S={},j=[],O=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function I(e,t){for(var n in t)e[n]=t[n];return e}function q(e){var t=e.parentNode;t&&t.removeChild(e)}function E(e,t,n,i,o){var r={type:e,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:o??++b};return null!=_.vnode&&_.vnode(r),r}function C(e){return e.children}function $(e,t){this.props=e,this.context=t}function M(e,t){if(null==t)return e.__?M(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?M(e):null}function N(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return N(e)}}function P(e){(!e.__d&&(e.__d=!0)&&y.push(e)&&!A.__r++||k!==_.debounceRendering)&&((k=_.debounceRendering)||w)(A)}function A(){for(var e;A.__r=y.length;)e=y.sort((function(e,t){return e.__v.__b-t.__v.__b})),y=[],e.some((function(e){var t,n,i,o,r,s;e.__d&&(r=(o=(t=e).__v).__e,(s=t.__P)&&(n=[],(i=I({},o)).__v=o.__v+1,W(s,o,i,t.__n,void 0!==s.ownerSVGElement,null!=o.__h?[r]:null,n,r??M(o),o.__h),R(n,o),o.__e!=r&&N(o)))}))}function L(e,t,n,i,o,r,s,a,l,c){var d,u,h,f,p,v,m,g=i&&i.__k||j,_=g.length;for(n.__k=[],d=0;d<t.length;d++)if(null!=(f=n.__k[d]=null==(f=t[d])||"boolean"==typeof f?null:"string"==typeof f||"number"==typeof f||"bigint"==typeof f?E(null,f,null,null,f):Array.isArray(f)?E(C,{children:f},null,null,null):f.__b>0?E(f.type,f.props,f.key,null,f.__v):f)){if(f.__=n,f.__b=n.__b+1,null===(h=g[d])||h&&f.key==h.key&&f.type===h.type)g[d]=void 0;else for(u=0;u<_;u++){if((h=g[u])&&f.key==h.key&&f.type===h.type){g[u]=void 0;break}h=null}W(e,f,h=h||S,o,r,s,a,l,c),p=f.__e,(u=f.ref)&&h.ref!=u&&(m||(m=[]),h.ref&&m.push(h.ref,null,f),m.push(u,f.__c||p,f)),null!=p?(null==v&&(v=p),"function"==typeof f.type&&null!=f.__k&&f.__k===h.__k?f.__d=l=T(f,l,e):l=U(e,f,h,g,p,l),c||"option"!==n.type?"function"==typeof n.type&&(n.__d=l):e.value=""):l&&h.__e==l&&l.parentNode!=e&&(l=M(h))}for(n.__e=v,d=_;d--;)null!=g[d]&&("function"==typeof n.type&&null!=g[d].__e&&g[d].__e==n.__d&&(n.__d=M(i,d+1)),Y(g[d],g[d]));if(m)for(d=0;d<m.length;d++)B(m[d],m[++d],m[++d])}function T(e,t,n){var i,o;for(i=0;i<e.__k.length;i++)(o=e.__k[i])&&(o.__=e,t="function"==typeof o.type?T(o,t,n):U(n,o,o,e.__k,o.__e,t));return t}function U(e,t,n,i,o,r){var s,a,l;if(void 0!==t.__d)s=t.__d,t.__d=void 0;else if(null==n||o!=r||null==o.parentNode)e:if(null==r||r.parentNode!==e)e.appendChild(o),s=null;else{for(a=r,l=0;(a=a.nextSibling)&&l<i.length;l+=2)if(a==o)break e;e.insertBefore(o,r),s=r}return void 0!==s?s:o.nextSibling}function D(e,t,n){"-"===t[0]?e.setProperty(t,n):e[t]=null==n?"":"number"!=typeof n||O.test(t)?n:n+"px"}function H(e,t,n,i,o){var r;e:if("style"===t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof i&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||D(e.style,t,"");if(n)for(t in n)i&&n[t]===i[t]||D(e.style,t,n[t])}else if("o"===t[0]&&"n"===t[1])r=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+r]=n,n?i||e.addEventListener(t,r?z:F,r):e.removeEventListener(t,r?z:F,r);else if("dangerouslySetInnerHTML"!==t){if(o)t=t.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if("href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&t in e)try{e[t]=n??"";break e}catch(e){}"function"==typeof n||(null!=n&&(!1!==n||"a"===t[0]&&"r"===t[1])?e.setAttribute(t,n):e.removeAttribute(t))}}function F(e){this.l[e.type+!1](_.event?_.event(e):e)}function z(e){this.l[e.type+!0](_.event?_.event(e):e)}function W(e,t,n,i,o,r,s,a,l){var c,d,u,h,f,p,v,m,g,b,y,w=t.type;if(void 0!==t.constructor)return null;null!=n.__h&&(l=n.__h,a=t.__e=n.__e,t.__h=null,r=[a]),(c=_.__b)&&c(t);try{e:if("function"==typeof w){if(m=t.props,g=(c=w.contextType)&&i[c.__c],b=c?g?g.props.value:c.__:i,n.__c?v=(d=t.__c=n.__c).__=d.__E:("prototype"in w&&w.prototype.render?t.__c=d=new w(m,b):(t.__c=d=new $(m,b),d.constructor=w,d.render=G),g&&g.sub(d),d.props=m,d.state||(d.state={}),d.context=b,d.__n=i,u=d.__d=!0,d.__h=[]),null==d.__s&&(d.__s=d.state),null!=w.getDerivedStateFromProps&&(d.__s==d.state&&(d.__s=I({},d.__s)),I(d.__s,w.getDerivedStateFromProps(m,d.__s))),h=d.props,f=d.state,u)null==w.getDerivedStateFromProps&&null!=d.componentWillMount&&d.componentWillMount(),null!=d.componentDidMount&&d.__h.push(d.componentDidMount);else{if(null==w.getDerivedStateFromProps&&m!==h&&null!=d.componentWillReceiveProps&&d.componentWillReceiveProps(m,b),!d.__e&&null!=d.shouldComponentUpdate&&!1===d.shouldComponentUpdate(m,d.__s,b)||t.__v===n.__v){d.props=m,d.state=d.__s,t.__v!==n.__v&&(d.__d=!1),d.__v=t,t.__e=n.__e,t.__k=n.__k,t.__k.forEach((function(e){e&&(e.__=t)})),d.__h.length&&s.push(d);break e}null!=d.componentWillUpdate&&d.componentWillUpdate(m,d.__s,b),null!=d.componentDidUpdate&&d.__h.push((function(){d.componentDidUpdate(h,f,p)}))}d.context=b,d.props=m,d.state=d.__s,(c=_.__r)&&c(t),d.__d=!1,d.__v=t,d.__P=e,c=d.render(d.props,d.state,d.context),d.state=d.__s,null!=d.getChildContext&&(i=I(I({},i),d.getChildContext())),u||null==d.getSnapshotBeforeUpdate||(p=d.getSnapshotBeforeUpdate(h,f)),y=null!=c&&c.type===C&&null==c.key?c.props.children:c,L(e,Array.isArray(y)?y:[y],t,n,i,o,r,s,a,l),d.base=t.__e,t.__h=null,d.__h.length&&s.push(d),v&&(d.__E=d.__=null),d.__e=!1}else null==r&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=V(n.__e,t,n,i,o,r,s,l);(c=_.diffed)&&c(t)}catch(e){t.__v=null,(l||null!=r)&&(t.__e=a,t.__h=!!l,r[r.indexOf(a)]=null),_.__e(e,t,n)}}function R(e,t){_.__c&&_.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){_.__e(e,t.__v)}}))}function V(e,t,n,i,o,r,s,a){var l,c,d,u=n.props,h=t.props,f=t.type,p=0;if("svg"===f&&(o=!0),null!=r)for(;p<r.length;p++)if((l=r[p])&&(l===e||(f?l.localName==f:3==l.nodeType))){e=l,r[p]=null;break}if(null==e){if(null===f)return document.createTextNode(h);e=o?document.createElementNS("http://www.w3.org/2000/svg",f):document.createElement(f,h.is&&h),r=null,a=!1}if(null===f)u===h||a&&e.data===h||(e.data=h);else{if(r=r&&g.call(e.childNodes),c=(u=n.props||S).dangerouslySetInnerHTML,d=h.dangerouslySetInnerHTML,!a){if(null!=r)for(u={},p=0;p<e.attributes.length;p++)u[e.attributes[p].name]=e.attributes[p].value;(d||c)&&(d&&(c&&d.__html==c.__html||d.__html===e.innerHTML)||(e.innerHTML=d&&d.__html||""))}if(function(e,t,n,i,o){var r;for(r in n)"children"===r||"key"===r||r in t||H(e,r,null,n[r],i);for(r in t)o&&"function"!=typeof t[r]||"children"===r||"key"===r||"value"===r||"checked"===r||n[r]===t[r]||H(e,r,t[r],n[r],i)}(e,h,u,o,a),d)t.__k=[];else if(p=t.props.children,L(e,Array.isArray(p)?p:[p],t,n,i,o&&"foreignObject"!==f,r,s,r?r[0]:n.__k&&M(n,0),a),null!=r)for(p=r.length;p--;)null!=r[p]&&q(r[p]);a||("value"in h&&void 0!==(p=h.value)&&(p!==e.value||"progress"===f&&!p)&&H(e,"value",p,u.value,!1),"checked"in h&&void 0!==(p=h.checked)&&p!==e.checked&&H(e,"checked",p,u.checked,!1))}return e}function B(e,t,n){try{"function"==typeof e?e(t):e.current=t}catch(e){_.__e(e,n)}}function Y(e,t,n){var i,o;if(_.unmount&&_.unmount(e),(i=e.ref)&&(i.current&&i.current!==e.__e||B(i,null,t)),null!=(i=e.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(e){_.__e(e,t)}i.base=i.__P=null}if(i=e.__k)for(o=0;o<i.length;o++)i[o]&&Y(i[o],t,"function"!=typeof e.type);n||null==e.__e||q(e.__e),e.__e=e.__d=void 0}function G(e,t,n){return this.constructor(e,n)}function J(e,t){var n={__c:t="__cC"+x++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e){var n,i;return this.getChildContext||(n=[],(i={})[t]=this,this.getChildContext=function(){return i},this.shouldComponentUpdate=function(e){this.props.value!==e.value&&n.some(P)},this.sub=function(e){n.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){n.splice(n.indexOf(e),1),t&&t.call(e)}}),e.children}};return n.Provider.__=n.Consumer.contextType=n}g=j.slice,_={__e:function(e,t){for(var n,i,o;t=t.__;)if((n=t.__c)&&!n.__)try{if((i=n.constructor)&&null!=i.getDerivedStateFromError&&(n.setState(i.getDerivedStateFromError(e)),o=n.__d),null!=n.componentDidCatch&&(n.componentDidCatch(e),o=n.__d),o)return n.__E=n}catch(t){e=t}throw e}},b=0,$.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=I({},this.state),"function"==typeof e&&(e=e(I({},n),this.props)),e&&I(n,e),null!=e&&this.__v&&(t&&this.__h.push(t),P(this))},$.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),P(this))},$.prototype.render=C,y=[],w="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,A.__r=0,x=0;var Q=0;function Z(e,t,n,i,o){var r,s,a={};for(s in t)"ref"==s?r=t[s]:a[s]=t[s];var l={type:e,props:a,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--Q,__source:i,__self:o};if("function"==typeof e&&(r=e.defaultProps))for(s in r)void 0===a[s]&&(a[s]=r[s]);return _.vnode&&_.vnode(l),l}function K(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}function X(){return Z("a",Object.assign({style:"float: right",href:"https://github.com/youdz/d2-stash-organizer","aria-label":"Source code on GitHub",target:"_blank"},{children:Z("svg",Object.assign({style:"fill: white",height:"32",viewBox:"0 0 16 16",version:"1.1",width:"32","aria-hidden":"true"},{children:Z("path",{"fill-rule":"evenodd",d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"},void 0)}),void 0)}),void 0)}K(".accessible-font{font-family:Verdana,Arial,Helvetica,sans-serif;font-weight:400;letter-spacing:normal}h1{font-family:AvQuest;font-weight:700;letter-spacing:1px;margin-top:0}.hidden{display:none}.sr-only{height:1px;left:-1px;overflow:hidden;position:fixed;top:-1px;width:1px}a,a:visited{color:#c7b377}.button,a,a:visited{text-decoration:none}.button{appearance:none;background:transparent;border:2px solid;border-color:initial;border-radius:0;box-shadow:none;color:#fff;cursor:pointer;font-family:inherit;font-size:inherit;font-weight:inherit;letter-spacing:1px;margin:0;padding:.4em .8em;text-align:initial}li input[type=radio]{margin-bottom:.6em;vertical-align:-12%}.magic{color:#6969ff}.rare{color:#ffff64}.unique{color:#c7b377}.set{color:#0f0}.crafted{color:#ffa800}.sidenote,.socketed{color:#787878}.danger{color:#ff6f6f}");var ee,te,ne,ie=0,oe=[],re=_.__b,se=_.__r,ae=_.diffed,le=_.__c,ce=_.unmount;function de(e,t){_.__h&&_.__h(te,e,ie||t),ie=0;var n=te.__H||(te.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function ue(e){return ie=1,function(e,t,n){var i=de(ee++,2);return i.t=e,i.__c||(i.__=[n?n(t):ke(void 0,t),function(e){var t=i.t(i.__[0],e);i.__[0]!==t&&(i.__=[t,i.__[1]],i.__c.setState({}))}],i.__c=te),i.__}(ke,e)}function he(e,t){var n=de(ee++,3);!_.__s&&we(n.__H,t)&&(n.__=e,n.__H=t,te.__H.__h.push(n))}function fe(e){return ie=5,pe((function(){return{current:e}}),[])}function pe(e,t){var n=de(ee++,7);return we(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function ve(e,t){return ie=8,pe((function(){return e}),t)}function me(e){var t=te.context[e.__c],n=de(ee++,9);return n.c=e,t?(null==n.__&&(n.__=!0,t.sub(te)),t.props.value):e.__}function ge(){oe.forEach((function(e){if(e.__P)try{e.__H.__h.forEach(be),e.__H.__h.forEach(ye),e.__H.__h=[]}catch(t){e.__H.__h=[],_.__e(t,e.__v)}})),oe=[]}_.__b=function(e){te=null,re&&re(e)},_.__r=function(e){se&&se(e),ee=0;var t=(te=e.__c).__H;t&&(t.__h.forEach(be),t.__h.forEach(ye),t.__h=[])},_.diffed=function(e){ae&&ae(e);var t=e.__c;t&&t.__H&&t.__H.__h.length&&(1!==oe.push(t)&&ne===_.requestAnimationFrame||((ne=_.requestAnimationFrame)||function(e){var t,n=function(){clearTimeout(i),_e&&cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(n,100);_e&&(t=requestAnimationFrame(n))})(ge)),te=void 0},_.__c=function(e,t){t.some((function(e){try{e.__h.forEach(be),e.__h=e.__h.filter((function(e){return!e.__||ye(e)}))}catch(n){t.some((function(e){e.__h&&(e.__h=[])})),t=[],_.__e(n,e.__v)}})),le&&le(e,t)},_.unmount=function(e){ce&&ce(e);var t=e.__c;if(t&&t.__H)try{t.__H.__.forEach(be)}catch(e){_.__e(e,t.__v)}};var _e="function"==typeof requestAnimationFrame;function be(e){var t=te;"function"==typeof e.__c&&e.__c(),te=t}function ye(e){var t=te;e.__c=e.__(),te=t}function we(e,t){return!e||e.length!==t.length||t.some((function(t,n){return t!==e[n]}))}function ke(e,t){return"function"==typeof t?t(e):t}class xe{constructor(e){this.raw=e,this.peek=!1,this.nextIndex=0,this.dataView=new DataView(this.raw.buffer)}moveTo(e){this.peek||(this.nextIndex=e)}get done(){return this.nextIndex>=this.raw.length}read(e,t=this.nextIndex){return this.moveTo(t+e),this.raw.slice(t,t+e)}readString(e,t=this.nextIndex){return String.fromCharCode(...this.read(e,t))}readNullTerminatedString(e=this.nextIndex){const t=[];for(;this.raw[e]>0;)t.push(this.raw[e]),e++;return e++,this.moveTo(e),String.fromCharCode(...t)}readRemaining(e=this.nextIndex){return this.moveTo(this.raw.length),this.raw.slice(e,this.raw.length)}readInt8(e=this.nextIndex){return this.moveTo(e+1),this.dataView.getUint8(e)}readInt16LE(e=this.nextIndex){return this.moveTo(e+2),this.dataView.getUint16(e,!0)}readInt32LE(e=this.nextIndex){return this.moveTo(e+4),this.dataView.getUint32(e,!0)}}function Se(e){let t="",n=0;const i={skip:e=>(n+=e,!1),read(i,o=n){const r=o+i-t.length;return r>0&&(t+=e.read(Math.ceil(r/8)).reduce(((e,t)=>e+Oe(t,8)),"")),n=o+i,t.slice(o,o+i)},readInt:(e,t=n)=>je(i.read(e,t)),readBool:(e=n)=>"1"===i.read(1,e),done:()=>t.slice(0,n)};return i}function je(e){return parseInt(e.split("").reverse().join(""),2)}function Oe(e,t){return e.toString(2).padStart(t,"0").split("").reverse().join("")}function Ie(e){const t=[];for(let n=0;n<e.length/8;n++)t.push(je(e.slice(8*n,8*(n+1))));return t}function qe(e){var o;const r=t[e.code]||n[e.code]||i[e.code];if(!r)throw new Error(`Could not find base ${e.code} for ${null!==(o=e.name)&&void 0!==o?o:"unknown item"}`);return r}const Ee=[[[[["w","u"],[["8",["y",["5",["j",[]]]]],"h"]],["s",[["2","n"],"x"]]],[[["c",["k","f"]],"b"],[["t","m"],["9","7"]]]],[" ",[[[["e","d"],"p"],["g",[[["z","q"],"3"],["v","6"]]]],[["r","l"],["a",[["1",["4","0"]],["i","o"]]]]]]],Ce=new Map;function $e(e,t){const{read:n,readBool:i,readInt:o,skip:r}=e,s={raw:"",owner:t,identified:r(4)||i(),socketed:r(6)||i(),simple:r(9)||i(),ethereal:i(),personalized:r(1)||i(),runeword:r(1)||i(),version:r(5)||(t.version>=97?n(3):o(10).toString()),location:o(3),equippedInSlot:o(4),column:o(4),row:o(4),stored:o(3),code:"",search:"",isStack:!1};t.version>=97?s.code=function(e,t){let n="";for(let i=0;i<t;i++){let t=Ee;for(;Array.isArray(t);)t=t[Number(e.read(1))];n+=t}return n}(e,4).trim():s.code=String.fromCharCode(o(8),o(8),o(8),o(8)).trim();const a=qe(s);return void 0===a?(console.error("base  === undefined"),n(2),s):("ques"===a.type&&a.trackQuestDifficulty&&n(2),["orbx","gemx","runx","bowq","xboq","key","book"].includes(a.type)&&(s.isStack=!0),s.nbFilledSockets=o(s.simple?1:3),s.socketed&&s.nbFilledSockets>0&&(s.filledSockets=[]),s.simple&&(s.name=a.name),s)}function Me({read:e,readInt:o},r){const s=t[r.code],a=n[r.code],l=i[r.code];if(s&&(r.defense=o(11)-10),s||a){const t=o(8);t&&(r.durability=[o(8),t],e(1))}((null==s?void 0:s.stackable)||(null==a?void 0:a.stackable)||(null==l?void 0:l.stackable))&&(r.quantity=o(9)),r.socketed&&(r.sockets=o(4))}!function e(t,n=""){t&&(Array.isArray(t)?(e(t[0],n+"0"),e(t[1],n+"1")):Ce.set(t,n))}(Ee);class Ne extends Error{constructor(e,t){let n=e.name;if(!n)try{n=qe(e).name}catch(t){n=`item with code ${e.code}`}n+=` at row ${e.row}, column ${e.column}`;let i=`Failed to parse ${n}`;t&&(i+=`: ${t}`),super(i),this.name="ItemParsingError"}}const Pe=["item_armor_percent","armorclass","item_armor_perlevel","item_armorpercent_perlevel"];function Ae({readInt:t},n){const i=[];let o=t(9),r=0;for(;511!=o;){let s=e[o];if((null==s||null==s)&&(r++,o=t(9),s=e[o],r>1e3))throw new Ne(n,`Unknown mod ${o}`);if(o>403&&(r++,o=t(9),s=e[o],r>1e3))throw new Ne(n,`Unknown mod ${o}`);if(null==s)return i;let a={id:o,stat:s.stat,priority:s.descPriority};if(3===s.encode)a={...a,level:t(6)-s.bias,spell:t(10)-s.bias,charges:t(8)-s.bias,maxCharges:t(8)-s.bias};else if(2===s.encode)a={...a,level:t(6)-s.bias,spell:t(10)-s.bias,chance:t(s.size)-s.bias};else{let e;s.paramSize&&(e=t(s.paramSize)-s.bias),a={...a,value:t(s.size)-s.bias,param:e}}i.push(a),Pe.includes(a.stat)&&(n.enhancedDefense=!0),"maxdurability"===s.stat&&(n.extraDurability=a.value),o=s.followedBy?s.followedBy:t(9)}return i}function Le(e,t){const n=Se(e);if(t.version<=96){const e=String.fromCharCode(n.readInt(8),n.readInt(8));if("JM"!==e)throw new Error(`Unexpected header ${e} for an item`)}const c=$e(n,t);if(c.isStack&&!c.simple&&(Me(n,c),n.readInt(64)),!c.isStack&&!c.simple)try{!function({read:e,readBool:t,readInt:n},c){var d,u;switch(c.id=n(32),c.level=n(7),c.quality=n(4),t()&&(c.picture=n(3)),t()&&(c.classSpecificAffix=n(11)),c.quality){case 2:c.name=qe(c).name;break;case 1:c.qualityModifier=n(3),c.name=`Low Quality ${qe(c).name}`;break;case 3:c.qualityModifier=n(3),c.name=`Superior ${qe(c).name}`;break;case 4:c.prefixes=[n(11)],c.suffixes=[n(11)],c.name=qe(c).name,c.prefixes[0]&&null!=a[c.prefixes[0]]&&(c.name=`${a[c.prefixes[0]].name} ${c.name}`),c.suffixes[0]&&null!=l[c.suffixes[0]]&&(c.name=`${c.name} ${l[c.suffixes[0]].name}`);break;case 5:c.unique=n(12),c.name=s[c.unique].name;break;case 7:c.unique=n(12),c.name=r[c.unique].name;break;case 6:case 8:c.name=`${o[n(8)]} ${o[n(8)]}`,c.prefixes=[],c.suffixes=[];for(let e=0;e<6;e++)t()&&(null===(d=c[e%2?"suffixes":"prefixes"])||void 0===d||d.push(n(11)))}if(c.runeword&&(c.runewordId=n(12)-27,2691===c.runewordId&&(c.runewordId=21),e(4)),c.personalized){let e,t="";for(;0!==(e=n(8));)t+=String.fromCharCode(e);c.name=`${t}'s ${c.name}`}"book"===(null===(u=i[c.code])||void 0===u?void 0:u.type)&&e(5),e(1)}(n,c),Me(n,c),function(e,t){t.modifiers=[];const n=5===t.quality?e.read(5):void 0;if(t.runeword&&t.modifiers.push(...Ae(e,t)),t.modifiers.push(...Ae(e,t)),n){t.setItemModifiers=[];for(let i=0;i<n.length;i++)"1"===n[i]?t.setItemModifiers.push(Ae(e,t)):t.setItemModifiers.push([])}}(n,c)}catch(e){"string"==typeof e?console.error(e.toUpperCase()):e instanceof Error&&(console.error(e.stack),console.error(e.message)),console.log("@@@ couldn't parse item: ",c)}return c.raw=n.done(),c}function Te(e,t){var n,i;const o=e.readString(2);if("JM"!==o)throw new Error(`Unexpected header ${o} for an item list`);let r=e.readInt16LE();console.warn("Total Items:%s",r);const s=[];let a="";for(;r>0;){console.warn("remainingItems:%s, %s",r,t.filename);const o=Le(e,t);if(null!=o){if(6===o.location){const e=s[s.length-1];if(!e.filledSockets)throw new Error("Trying to socket a non-socketed item");o.socketedIn=e,a+=o.code,e.filledSockets.push(o),e.filledSockets.length==e.sockets&&(e.name=null===(n=c.find((e=>e.word==a)))||void 0===n?void 0:n.name,a="")}else s.push(o),r+=null!==(i=o.nbFilledSockets)&&void 0!==i?i:0;r--}else r--}return s}function Ue({prop:e,min:t,max:n,param:i},o,r){var s,a;const{stats:l}=u[e];for(const{stat:c,type:u}of l)if("other"===u||"param"===u&&!i){let l=e=>e.stat===c;if("skill"===e)l=e=>"param"in e&&e.param===i&&e.stat===c;else if("skilltab"===e){const e=null===(s=d[Number(i)])||void 0===s?void 0:s.id;l=t=>"param"in t&&t.param===e&&t.stat===c}const u=null==o?void 0:o.find(l);if(("dmg-min"===e||"dmg-max"===e)&&void 0===u)continue;u&&(u.range=[t,n]),r(null!==(a=null==u?void 0:u.value)&&void 0!==a?a:0,t,n)}else if("all"===u){const e=null==o?void 0:o.find((e=>e.stat===c));e&&(e.range=[t,n])}}const De=["sock"];function He(t){const n=[];for(const{prop:i,min:o,max:r,param:s}of t){if(De.includes(i))continue;const{stats:t}=u[i];for(const{stat:a,type:l,param:c}of t){const t=e.findIndex((e=>(null==e?void 0:e.stat)===a));if(t<0)throw new Error(`Unknown mod ${a}`);const u=n[n.length-1],h={id:t,stat:a,priority:e[t].descPriority};switch(l){case"proc":n.push({...h,level:r,spell:Number(s),chance:o});break;case"charges":n.push({...h,level:r,spell:Number(s),charges:o,maxCharges:o});break;case"all":if(!("value"in u))throw new Error("No previous mod to copy");n.push({...h,value:u.value,param:u.param});break;case"min":n.push({...h,value:o});break;case"max":n.push({...h,value:r});break;case"param":n.push({...h,value:Number(s)});break;case"other":o!==r&&console.error(`Unexpected range modifier ${i}: ${o}-${r}`),n.push({...h,value:r,param:s?"item_addskill_tab"===a?d[Number(s)].id:s:c})}}}return n}function Fe(e,n){if(e.modifiers||(e.modifiers=[]),"jew"===n.code)e.modifiers.push(...n.modifiers);else{const i=h[n.code];if(!i)throw new Ne(e,"Only gems, runes and jewels can be put in sockets");const o=t[e.code];let r;r=o?"shie"===o.type||"head"===o.type||"ashd"===o.type?i.shield:i.armor:i.weapon,e.modifiers.push(...He(r))}}function ze(e,t){return e.id===t.id&&"value"in e&&e.param===t.param}function We(t,n=e[t.id]){var i,o,r,s,a,l;if(!n)return;let c=t.value;n.stat.endsWith("perlevel")&&(n.stat.includes("tohit")?c/=2:c/=8,c=Math.floor(99*c));let u,h,v,m,g=(null!=c?c:0)<0?n.descNeg:n.descPos;switch(n.descFunc){case 1:case 6:case 12:u=(null!=c?c:0)<0?`${c}`:`+${c}`;break;case 2:case 7:case 22:case 23:u=`${c}%`;break;case 3:case 9:u=`${c}`;break;case 4:case 8:u=(null!=c?c:0)<0?`${c}%`:`+${c}%`;break;case 5:u=`${Math.floor(100*c/128)}%`;break;case 11:g=g.replace("%d",""+100/c);break;case 13:g=p[t.param].skillsMod,u=`+${c}`;break;case 14:if(v=d.find((({id:e})=>e===t.param)),!v)throw new Error(`Unknown skill tab ${v}`);g=`+${c} to ${v.name} ${p[v.charClass].classOnly}`;break;case 15:m="",null==f[t.spell]?console.error("NO SKILL FOUND:%s",t.spell):m=f[t.spell].name,g=g.replace("%d%",`${t.chance}`).replace("%d",`${t.level}`).replace("%s",`${m}`);break;case 16:g=g.replace("%d",`${c}`).replace("%s",`${f[t.param].name}`);break;case 19:g=g.replace("%d",`${c}`);break;case 20:u=-c+"%";break;case 24:g=`Level ${t.level} ${f[t.spell].name} ${g.replace("%d",`${t.charges}`).replace("%d",`${t.maxCharges}`)}`;break;case 27:h=f[t.param],g=`+${c} to ${h.name} ${p[h.charClass].classOnly}`;break;case 28:g=`+${c} to ${f[t.param].name}`;break;case 100:(null===(i=t.values)||void 0===i?void 0:i[0])!==(null===(o=t.values)||void 0===o?void 0:o[1])&&(g=n.descNeg),g=g.replace("%d",`${null===(r=t.values)||void 0===r?void 0:r[0]}`).replace("%d",`${null===(s=t.values)||void 0===s?void 0:s[1]}`);break;case 101:g=(null===(a=t.values)||void 0===a?void 0:a[0])===(null===(l=t.values)||void 0===l?void 0:l[1])?g.replace("%d",`${Math.round(t.values[0]*t.values[2]/256)}`).replace("%d",`${Math.round(t.values[2]/25)}`):n.descNeg.replace("%d",`${Math.round(t.values[0]*t.values[2]/256)}`).replace("%d",`${Math.round(t.values[1]*t.values[2]/256)}`).replace("%d",`${Math.round(t.values[2]/25)}`)}if(g){let e="";switch(n.descVal){case 1:e=`${u} ${g}`;break;case 2:e=`${g} ${u}`;break;default:e=g}return 6<=n.descFunc&&n.descFunc<=9&&(e+=` ${n.descAdditional}`),e}}function Re(e,t){var n,i,o;const r=null!==(n=null==t?void 0:t.filter((({id:t})=>e.statsInGroup.includes(t))))&&void 0!==n?n:[];if(r.length!==e.statsInGroup.length)return!1;if(e.allEqual&&r.some((({value:e})=>e!==r[0].value)))return!1;if(e.isRange&&(null!==(i=r[0].value)&&void 0!==i?i:0)>(null!==(o=r[1].value)&&void 0!==o?o:0))return!1;if(("group:secondary-dmg"===e.stat||"group:min-dmg"===e.stat||"group:max-dmg"===e.stat)&&(null==t?void 0:t.find((e=>"group:primary-dmg"===e.stat)))){for(const e of r)delete e.description;return!1}const s={id:-1,stat:e.stat,priority:e.descPriority,value:e.allEqual?r[0].value:void 0,values:r.map((({value:e})=>null!=e?e:0))};s.description=We(s,e),e.allEqual&&(s.range=r[0].range),null==t||t.push(s);for(const e of r)delete e.description;return!0}function Ve(e,t,n=""){for(const e of t)e.description=We(e),e.description&&n&&(e.description+=n);!function(e){for(const t of v)Re(t,e)}(t),t.sort((({priority:e,param:t},{priority:n,param:i})=>n-e||(null!=i?i:0)-(null!=t?t:0)));for(const{description:n}of t)n&&(e.search+=`${n}\n`)}function Be(e){var t,n;if((e.runeword||7===e.quality||5===e.quality)&&function(e){var t;if(!e.modifiers)return 0;let n,i=e.modifiers;if(e.runeword)n=[];else if(7===e.quality)n=r[e.unique].modifiers;else{if(5!==e.quality)throw new Error("Only uniques, sets and runewords have a perfection score.");n=[...s[e.unique].baseModifiers,...s[e.unique].setModifiers.flat()],i=[...e.modifiers,...e.setItemModifiers.flat()]}n=n.filter((({prop:e})=>"bloody"!==e));const o=qe(e);let a=0,l=0;function c(e,t,n){t!==n&&(a=(l*a+(e-t)/(n-t))/++l)}for(const t of n)t.min!==t.max&&("sock"!==t.prop?Ue(t,i,c):(e.socketsRange=[t.min,Math.min(t.max,o.maxSockets)],c(e.sockets,...e.socketsRange)));if((7===e.quality||5===e.quality)&&"def"in o&&!n.some((({prop:e})=>"ac%"===e))){const n=null!==(t=e.defense)&&void 0!==t?t:0,i=e.ethereal?1.5:1;e.defenseRange=[Math.floor(o.def[0]*i),Math.floor(o.def[1]*i)],c(n,...e.defenseRange)}e.perfectionScore=0===l?100:Math.floor(100*a)}(e),e.filledSockets)for(const t of e.filledSockets)Fe(e,t);if(e.modifiers&&(!function(e){var t,n,i,o,r,s,a,l,c,d,u,h,f,p;for(const v of e){let m;for(;(m=e.findIndex((e=>v!==e&&ze(v,e))))>=0;){const[g]=e.splice(m,1);v.value=(null!==(t=v.value)&&void 0!==t?t:0)+(null!==(n=g.value)&&void 0!==n?n:0),(v.range||g.range)&&(v.range=[(null!==(r=null!==(o=null===(i=v.range)||void 0===i?void 0:i[0])&&void 0!==o?o:v.value)&&void 0!==r?r:0)+(null!==(l=null!==(a=null===(s=g.range)||void 0===s?void 0:s[0])&&void 0!==a?a:g.value)&&void 0!==l?l:0),(null!==(u=null!==(d=null===(c=v.range)||void 0===c?void 0:c[1])&&void 0!==d?d:v.value)&&void 0!==u?u:0)+(null!==(p=null!==(f=null===(h=g.range)||void 0===h?void 0:h[1])&&void 0!==f?f:g.value)&&void 0!==p?p:0)])}}}(e.modifiers),Ve(e,e.modifiers)),5===e.quality&&(null===(t=e.setItemModifiers)||void 0===t||t.forEach(((t,n)=>{Ve(e,t,` (${n+2} items)`)})),function(e){const t=5===e.quality&&m[s[e.unique].set];t&&(e.setGlobalModifiers=t.modifiers.map((e=>He(e))))}(e),null===(n=e.setGlobalModifiers)||void 0===n||n.forEach(((t,n)=>{Ve(e,t,n>=4?"":` (${n+2} items)`)}))),e.ethereal&&(e.search+="Ethereal\n"),e.sockets&&(e.search+=`Socketed (${e.sockets})\n`,e.search+=`${e.sockets} sockets\n`),e.filledSockets)for(const t of e.filledSockets)e.search+=`${t.name})\n`;e.search=e.search.toLowerCase()}function Ye(t,n){var i,o;const r=new xe(t);if("aa55aa55"!==r.readInt32LE().toString(16))throw new Error("This does not look like a Diablo 2 character save (.d2s)");const s={filename:null!==(i=null==n?void 0:n.name)&&void 0!==i?i:"",lastModified:null!==(o=null==n?void 0:n.lastModified)&&void 0!==o?o:0,version:r.readInt32LE(4),name:r.readNullTerminatedString(20),class:r.readInt8(40),hasCorpse:!1,hasMercenary:!!r.readInt32LE(179),characterData:new Uint8Array,golem:new Uint8Array,items:[]};return function(t){var n,i;const o=t.readString(2,765);if("gf"!==o)throw new Error(`Unexpected header ${o} for an attributes list`);const r=Se(t);let s;for(;511!==(s=r.readInt(9));)r.readInt(null!==(i=null===(n=e[s])||void 0===n?void 0:n.charSize)&&void 0!==i?i:0)}(r),r.readString(32),s.characterData=r.read(r.nextIndex-16,16),s.items.push(...Te(r,s)),function(e,t){const n=e.readString(2);if("JM"!==n)throw new Error(`Unexpected header ${n} for corpse data`);const i=e.readInt16LE();t.hasCorpse=i>0;for(let n=0;n<i;n++){e.read(12);const n=Te(e,t);for(const e of n)e.corpse=!0;t.items.push(...n)}}(r,s),function(e,t){const n=e.readString(2);if("jf"!==n)throw new Error(`Unexpected header ${n} for mercenary data`);if(t.hasMercenary){const n=Te(e,t);for(const e of n)e.mercenary=!0;t.items.push(...n)}}(r,s),s.golem=r.readRemaining(),function(e){for(const t of e.items)t.owner=e,Be(t)}(s),s}function Ge(e,t){const n=e.readString(2);if("ST"!==n)throw new Error(`Unexpected header ${n} for a stash page`);e.peek=!0,e.readNullTerminatedString(),e.read(1);const i="JM"!==e.readString(2);let o;return e.peek=!1,i&&(o=e.readInt8(),e.read(3)),{flags:o,name:e.readNullTerminatedString(),items:Te(e,t)}}function Je(e,t){var n,i,o;const r=new xe(e),s=r.readString(4);if("SSS\0"!==s&&"CSTM"!==s)throw new Error("This does not look like a plugy stash file (.sss or .d2x)");const a={filename:null!==(n=null==t?void 0:t.name)&&void 0!==n?n:"",lastModified:null!==(i=null==t?void 0:t.lastModified)&&void 0!==i?i:0,version:96,personal:"CSTM"===s,pageFlags:!0,gold:0,pages:[]};a.nonPlugY=!a.personal&&(null==t?void 0:t.name.endsWith(".d2x"));let l=10;const c=r.readString(2);if("01"===c)a.personal&&(l+=4);else{if("02"!==c)throw new Error("Your version of PlugY is too old.");a.gold=r.readInt32LE(),l+=4}for(r.read(0,l);!r.done;)try{a.pages.push(Ge(r,a))}catch(e){if(e instanceof Error)throw new Error(`${e.message} on page ${a.pages.length+1}`)}return a.pageFlags=void 0!==(null===(o=a.pages[0])||void 0===o?void 0:o.flags),function(e){e.pages.forEach((({items:t},n)=>{for(const i of t)i.owner=e,i.page=n,Be(i)}))}(a),a}class Qe{constructor(){this.raw=new Uint8Array(4096),this.dataView=new DataView(this.raw.buffer),this.nextIndex=0}done(){return this.raw=this.raw.slice(0,this.nextIndex),this.dataView=new DataView(this.raw.buffer),this.raw}get length(){return this.raw.length}skip(e){this.nextIndex+=e}write(e,t=this.nextIndex){const n=t+e.length;if(n>this.raw.length){const e=new Uint8Array(Math.max(this.raw.length+4096,n));e.set(this.raw),this.raw=e,this.dataView=new DataView(this.raw.buffer)}this.raw.set(e,t),this.nextIndex=n}writeString(e,t=this.nextIndex){const n=[];for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);this.write(n,t)}writeInt16LE(e,t=this.nextIndex){this.write(new Array(2).fill(0),t),this.dataView.setUint16(t,e,!0)}writeInt32LE(e,t=this.nextIndex){this.write(new Array(4).fill(0),t),this.dataView.setUint32(t,e,!0)}computeChecksum(){let e=0;for(const t of this.raw)e=e<<1|e>>>31,e+=t,e>>>=0;return e}}function Ze(e,t){var n;e.writeString("JM"),e.writeInt16LE(t.length);for(const i of t){e.write(Ie(i.raw));for(const t of null!==(n=i.filledSockets)&&void 0!==n?n:[])e.write(Ie(t.raw))}}function Ke(e){return"pages"in e}function Xe(e){return"personal"in e}function et(e){return"items"in e}function tt(e){return Xe(e)?e.personal?`${e.filename.slice(0,-4)}'s stash`:e.nonPlugY?"Offline stash":"PlugY shared stash":et(e)?e.filename.slice(0,-4):"Shared"}function nt(e,t){const n=e.readInt32LE().toString(16);if("aa55aa55"!==n)throw new Error(`Unexpected header ${n} for a stash page`);e.read(8);const i={gold:e.readInt32LE(),items:[]};return e.read(48),i.items.push(...Te(e,t)),i}function it(e,t){var n,i;const o=new xe(e);o.peek=!0;if("aa55aa55"!==o.readInt32LE().toString(16))throw new Error("This does not look like a Diablo 2 shared stash save (.d2i)");const r={filename:null!==(n=null==t?void 0:t.name)&&void 0!==n?n:"",lastModified:null!==(i=null==t?void 0:t.lastModified)&&void 0!==i?i:0,version:o.readInt32LE(8),pages:[]};o.peek=!1;let s=1;for(;!o.done;)s++,console.log("%s STASH",s),r.pages.push(nt(o,r));return function(e){e.pages.forEach((({items:t},n)=>{for(const i of t)i.owner=e,i.page=n,Be(i)}))}(r),r}async function ot(e){try{const t=new Uint8Array(await e.arrayBuffer());return e.name.endsWith(".d2s")?Ye(t,e):e.name.endsWith(".d2i")?it(t,e):Je(t,e)}catch(e){throw e instanceof Error&&alert(e.message),e}}function rt(e){let t,n;return Xe(e)?(t=function(e){const t=new Qe;e.personal?(t.writeString("CSTM"),t.writeString("01"),t.skip(4)):(t.writeString("SSS\0"),t.writeString("02"),t.writeInt32LE(e.gold)),t.writeInt32LE(e.pages.length);for(const n of e.pages)t.writeString("ST"),e.pageFlags&&(t.write([n.flags]),t.skip(3)),t.writeString(n.name),t.skip(1),Ze(t,n.items);return t.done()}(e),n=e.personal?"CharacterName.d2x":"_LOD_SharedStashSave.sss"):et(e)?(t=function(e){const t=new Qe;t.writeInt32LE(parseInt("aa55aa55",16)),t.writeInt32LE(e.version),t.skip(8),t.write(e.characterData),Ze(t,e.items.filter((e=>!e.mercenary&&!e.corpse)));const n=t.done();return t.writeInt32LE(t.length,8),t.writeInt32LE(t.computeChecksum(),12),n}(e),n="CharacterName.d2s"):(t=function(e){const t=new Qe;for(const n of e.pages){const i=t.nextIndex;t.writeInt32LE(parseInt("aa55aa55",16)),t.skip(4),t.writeInt32LE(e.version),t.writeInt32LE(n.gold);const o=t.nextIndex;t.skip(48),Ze(t,n.items);const r=t.nextIndex;t.writeInt32LE(r-i,o),t.write([],r)}return t.done()}(e),n="SharedStashSoftCoreV2.d2i"),new File([new Blob([t.buffer])],e.filename||n)}window.indexedDB||alert("Your browser doesn't support a stable version of IndexedDB. This application will not remember your stash between sessions.");const st="save_files",at=new Promise(((e,t)=>{const n=indexedDB.open("D2StashOrganizer",2);let i;n.onerror=function(){t("Unable to open IndexedDB")},n.onsuccess=function(){i?i.finally((()=>e(this.result))):e(this.result)},n.onupgradeneeded=function(e){const t=this.result,o=t.createObjectStore(st,{keyPath:"name"});if(e.oldVersion<1){const e=localStorage.getItem("stash");e&&(o.transaction.oncomplete=()=>{t.transaction(st,"readwrite").objectStore(st).add(rt(JSON.parse(e)))})}else e.oldVersion<2&&(i=new Promise(((e,t)=>{const i=n.transaction.objectStore("stash").get(0);i.onsuccess=function(){if(this.result){const i=n.transaction.objectStore(st).add(this.result);i.onsuccess=()=>e(),i.onerror=()=>t()}else e()},i.onerror=()=>t()})))}}));async function lt(){const e=await at.then((e=>new Promise(((t,n)=>{const i=e.transaction(st,"readonly").objectStore(st).getAll();i.onerror=function(){n("Unable to read save files.")},i.onsuccess=function(){t(this.result)}}))));return Promise.all(e.map((e=>ot(e))))}function ct(e){var t;let n="";for(const i of e){n+=i.raw;for(const e of null!==(t=i.filledSockets)&&void 0!==t?t:[])n+=e.raw}return n}const dt=J({selectedItems:new Set,toggleItem:()=>{},selectAll:()=>{},unselectAll:()=>{},resetSelection:()=>{}});function ut({children:e}){const[t,n]=ue(new Set),i=ve((e=>{n((t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n}))}),[]),o=ve((e=>t=>{n((n=>{const i=new Set(n);for(const n of t)i[e?"add":"delete"](n);return i}))}),[]),r=ve((()=>{n(new Set)}),[]),s=pe((()=>({selectedItems:t,toggleItem:i,selectAll:o(!0),unselectAll:o(!1),resetSelection:r})),[t,i,o,r]);return Z(dt.Provider,Object.assign({value:s},{children:e}),void 0)}const ht=J({owners:[],allItems:[],hasPlugY:!1,setCollection:()=>{},setSingleFile:()=>{}});function ft(e){e.sort(((e,t)=>tt(e).localeCompare(tt(t))));const t=e.some((e=>Xe(e)&&!e.nonPlugY)),n=t?function(e){const t=new Map;for(const n of e)Xe(n)&&n.pages.forEach(((e,i)=>{t.set(ct(e.items),[n,i])}));const n=new Map;for(const i of e){if(et(i)){const e=t.get(ct(i.items.filter((({stored:e})=>5===e))));e&&n.set(i,e)}return n}}(e):void 0,i=e.flatMap((e=>{let t=function(e,t=0){if(Ke(e)){const n=[];for(const{items:i}of e.pages.slice(t))n.push(...i);return n}return e.items}(e);return et(e)&&(null==n?void 0:n.has(e))&&(t=t.filter((e=>5!==e.stored))),t}));return{owners:e,allItems:i,hasPlugY:t,lastActivePlugyStashPage:n}}function pt({children:e}){const{resetSelection:t}=me(dt),[n,i]=ue({owners:[],allItems:[],hasPlugY:!1}),o=ve((e=>{i(ft(e)),t()}),[t]),r=ve((e=>{i((t=>{const n=[...t.owners],i=n.findIndex((t=>t.filename===e.filename));return i>=0?n.splice(i,1,e):n.push(e),ft(n)})),t()}),[t]),s=pe((()=>({...n,setCollection:o,setSingleFile:r})),[n,o,r]);return he((()=>{lt().then((e=>{o(e),!window.location.hash&&e.length>0&&(window.location.hash="#saves")}))}),[o]),Z(ht.Provider,Object.assign({value:s},{children:e}),void 0)}function vt(e){if(!e.quality||void 0===e.unique)return;let t;switch(e.quality){case 7:return t=r[e.unique],t.item=e,t;case 5:return t=s[e.unique],t.item=e,t;default:return}}const mt=[[{name:"Rings",shortName:"rings",types:["ring"],layout:"single-line"},{name:"Amulets",shortName:"amulets",types:["amul"]},{name:"Charms",shortName:"charms",types:["scha","mcha","lcha"],layout:"single-column"},{name:"Jewels",shortName:"jewels",types:["jewl"],layout:"single-line"}],[{name:"Armor",shortName:"armor",types:["tors"]},{name:"Helms",shortName:"helms",types:["helm","circ"]},{name:"Gloves",shortName:"gloves",types:["glov"]},{name:"Belts",shortName:"belts",types:["belt"],layout:"tier-columns"},{name:"Boots",shortName:"boots",types:["boot"]},{name:"Shields",shortName:"shields",types:["shie"]}],[{name:"One-hand axes",shortName:"axes",types:["axe"],twoHanded:!1},{name:"Two-hand axes",shortName:"axes",types:["axe"],twoHanded:!0},{name:"Bows",shortName:"bows",types:["bow"]},{name:"Crossbows",shortName:"crossbows",types:["xbow"]},{name:"Daggers",shortName:"daggers",types:["knif"]},{name:"One-hand maces",shortName:"maces",types:["club","mace","hamm","scep"],twoHanded:!1},{name:"Two-hand maces",shortName:"maces",types:["club","mace","hamm","scep"],twoHanded:!0},{name:"Polearms",shortName:"polearms",types:["pole"]},{name:"Spears",shortName:"spears",types:["spea"]},{name:"Staves",shortName:"staves",types:["staf"]},{name:"One-hand swords",shortName:"swords",types:["swor"],twoHanded:!1},{name:"Two-hand swords",shortName:"swords",types:["swor"],twoHanded:!0},{name:"Throwing",shortName:"throwing",types:["taxe","tkni","jave"]},{name:"Wands",shortName:"wands",types:["wand"]}],[{name:"Amazon",shortName:"Amazon",types:["ajav","abow","aspe"]},{name:"Assassin",shortName:"Assassin",types:["h2h","h2h2"]},{name:"Barbarian",shortName:"Barbarian",types:["phlm"]},{name:"Druid",shortName:"Druid",types:["pelt"]},{name:"Necromancer",shortName:"Necro",types:["head"]},{name:"Paladin",shortName:"Paladin",types:["ashd"]},{name:"Sorceress",shortName:"Sorceress",types:["orb"]}]],gt=[],_t=new Map;for(const e of mt)for(const t of e){gt.push(...t.types);for(const e of t.types)void 0===t.twoHanded?_t.set(e,t):_t.set(`${e}-${Number(t.twoHanded)}`,t)}function bt(e){return"enabled"in e||(e=vt(e)),!!e&&(!qe(e).indestructible&&e.modifiers.every((({prop:e})=>"indestruct"!==e&&"ethereal"!==e)))}function yt(e=!1){let t=r.filter((e=>e.enabled&&e.qlevel>0));e&&(t=t.filter(bt));const n=function(e,t){const n=new Map;for(const e of mt)for(const t of e)n.set(t,[]);for(const i of e){const e=qe(i),o=_t.get(e.type)||"twoHanded"in e&&_t.get(`${e.type}-${Number(e.twoHanded)}`);if(!o)continue;const r=n.get(o),s=t?e.tier:0;let a=r[s];a||(a=[],r[s]=a),a.push(i)}for(const[e,t]of n)n.set(e,t.filter((({length:e})=>e>0)));return n}(t,!0);for(const e of n.values())for(const t of e)t.sort(((e,t)=>e.qlevel-t.qlevel));return n}const wt=[[{name:"Low level sets",maxLevel:20}],[{name:"Mid level sets",maxLevel:60}],[{name:"High level sets",maxLevel:100}]],kt=[],xt=Object.entries(m);let St=0;for(const[{maxLevel:e}]of wt)kt.push(xt.filter((([,{levelReq:t}])=>St<=t&&t<e)).sort((([,e],[,t])=>e.levelReq-t.levelReq)).map((([e,{name:t}])=>{const n=t.lastIndexOf("'");n>=0&&!t.startsWith("Death")&&!t.startsWith("Heaven")&&!t.startsWith("Orphan")&&(t=t.slice(0,n));let i=t,o=t.indexOf("'",4);return o<0&&(o=t.indexOf(" ",4)),o>0&&(i=t.slice(0,o)),i.startsWith("The ")&&(i=i.slice(4)),{name:t,shortName:i,set:e}}))),St=e;function jt(e,t){const n=vt(t);if(n){let i=e.get(n);i||(i=[],e.set(n,i)),i.push(t)}}function Ot(e){const t=new Map;for(const n of e)if(jt(t,n),n.filledSockets)for(const e of n.filledSockets)jt(t,e);const n=new Map;for(const[e,i]of yt())n.set(e,i.map((e=>e.map((e=>{var n,i;return{item:e,normal:!!t.get(e),ethereal:bt(e)?!!(null===(n=t.get(e))||void 0===n?void 0:n.some((({ethereal:e})=>e))):void 0,perfect:!!(null===(i=t.get(e))||void 0===i?void 0:i.some((({perfectionScore:e})=>100===e)))}})))));for(const[e,i]of function(e){const t=new Map;for(const e of kt)for(const{set:n}of e)t.set(m[n],[]);for(const n of e){const e="set"in n?n:s[n.unique];t.get(m[e.set]).push(n)}return t}(s))n.set(e,[i.map((e=>{var n;return{item:e,normal:!!t.get(e),ethereal:void 0,perfect:!!(null===(n=t.get(e))||void 0===n?void 0:n.some((({perfectionScore:e})=>100===e)))}}))]);return n}function It(){const{allItems:e}=me(ht),{nbNormal:t,totalNormal:n,nbEth:i,totalEth:o,nbPerfect:r}=pe((()=>function(e){const t={nbNormal:0,totalNormal:0,nbEth:0,totalEth:0,nbPerfect:0,owners:[]};for(const n of Ot(e).values())for(const e of n)for(const{normal:n,ethereal:i,perfect:o}of e)t.totalNormal++,n&&t.nbNormal++,o&&t.nbPerfect++,void 0!==i&&(t.totalEth++,i&&t.nbEth++);return t}(e)),[e]);return Z("div",{children:[Z("p",{children:["Normal Grail: ",t," / ",n]},void 0),Z("p",{children:["Eth Grail: ",i," / ",o]},void 0),Z("p",{children:["Perfect Grail: ",r," / ",n]},void 0)]},void 0)}function qt({item:e}){let t=e,n="";if(null==e)return Z(C,{children:[void 0,void 0,n]},void 0);6===e.location&&(t=e.socketedIn,n=`, socketed in ${t.name}`);const i=function(e){if(!e.owner)return"Unknown location";const t=tt(e.owner);switch(e.location){case 0:switch(e.stored){case 5:return Xe(e.owner)?t:`In ${t}'s stash`;case 1:return`In ${t}'s inventory`;case 4:return`In ${t}'s cube`;default:return"Unknown location"}case 2:return`In ${t}'s belt`;case 1:return e.mercenary?`Worn by ${t}'s mercenary`:e.corpse?`On ${t}'s corpse`:`Worn by ${t}`;default:return"Unknown location"}}(t);return Z(C,{children:[i,void 0!==e.page?`, page ${e.page+1}`:"",n]},void 0)}K('.found{color:#6fb76f}.found:after{content:" ✔"}.missing{color:#ff6f6f}.missing:after{content:" ✘"}.location{color:#afafaf;font-size:smaller;font-weight:lighter}#grail-tracker{margin-top:1em}#grail-tracker th{font-weight:inherit;text-align:left}#grail-tracker td{padding:0 1em}#grail-tracker td[colspan]{padding-top:1em;text-align:center}');const Et=["Normal","Exceptional","Elite"],Ct=e=>e?"found":"missing";function $t(){const{allItems:e}=me(ht),[t,n]=ue("all"),i=pe((()=>Ot(e)),[e]),o=pe((()=>{const e=[];for(const[n,o]of i)o.forEach(((i,r)=>{const s=[];for(const{item:e,normal:n,ethereal:o,perfect:r}of i)n&&"missing"===t||r&&"perfect"===t||(void 0===o||o)&&"ethereal"===t||s.push(Z("tr",{children:[Z("th",Object.assign({scope:"row",class:"set"in e?"set":"unique"},{children:e.name}),void 0),Z("td",Object.assign({class:Ct(n)},{children:"Normal"}),void 0),Z("td",void 0===o?{children:Z("span",{"aria-label":"Not applicable"},void 0)}:Object.assign({class:Ct(o)},{children:"Ethereal"}),void 0),Z("td",Object.assign({class:Ct(r)},{children:"Perfect"}),void 0),Z("td",Object.assign({class:"location"},{children:[Z("td",{children:Z(qt,{item:e.item},void 0)},void 0)," "]}),void 0)]},void 0));if(0===s.length)return;const a=o.length>1?`${Et[r]} ${n.name}`:n.name;e.push(Z("tbody",{children:[Z("tr",{children:Z("td",Object.assign({colSpan:5},{children:a}),void 0)},void 0),s]},void 0))}));return e}),[t,i]);return Z(C,{children:[Z("div",Object.assign({class:"controls"},{children:[Z(It,{},void 0),Z("div",{children:[Z("p",{children:Z("label",Object.assign({for:"grail-filter"},{children:"Show:"}),void 0)},void 0),Z("p",{children:Z("select",Object.assign({id:"grail-filter",value:t,onChange:({currentTarget:e})=>n(e.value)},{children:[Z("option",Object.assign({value:"all"},{children:"All items"}),void 0),Z("option",Object.assign({value:"missing"},{children:"Missing items"}),void 0),Z("option",Object.assign({value:"ethereal"},{children:"Missing ethereal items"}),void 0),Z("option",Object.assign({value:"perfect"},{children:"Missing perfect items"}),void 0)]}),void 0)},void 0)]},void 0)]}),void 0),Z("table",Object.assign({id:"grail-tracker"},{children:o}),void 0)]},void 0)}function Mt({nbEntries:e,pageSize:t,currentEntry:n,onChange:i,text:o}){const r=Math.floor((e-1)/t)*t;return he((()=>{n>=e&&i(0)}),[e,n,i]),r<=0?null:Z("div",Object.assign({class:"pagination"},{children:[Z("div",Object.assign({style:{visibility:0===n?"hidden":"visible"}},{children:[Z("button",Object.assign({class:"button",onClick:()=>i(0)},{children:"First"}),void 0),Z("button",Object.assign({class:"button",onClick:()=>i((e=>e-t))},{children:"Previous"}),void 0)]}),void 0),Z("span",{children:o(n+1,Math.min(n+t,e))},void 0),Z("div",Object.assign({style:{visibility:n>=r?"hidden":"visible"}},{children:[Z("button",Object.assign({class:"button",onClick:()=>i((e=>e+t))},{children:"Next"}),void 0),Z("button",Object.assign({class:"button",onClick:()=>i(r)},{children:"Last"}),void 0)]}),void 0)]}),void 0)}K(".pagination{display:flex;flex-flow:row nowrap;justify-content:space-between;margin:2em 0}.pagination button:first-child{margin-right:1em}.pagination button[disabled]{cursor:default;opacity:0}");Array(10).fill(0).map(((e,t)=>t)),Array(10).fill(0).map(((e,t)=>t)),function(e){e.split("").map((e=>Oe(e.charCodeAt(0),8))).join("")}("JM");const Nt=["tes","ceh","bet","fed","toa"],Pt=["pk1","pk2","pk3","dhn","bey","mbr","std"];function At(e){return e.simple||Nt.includes(e.code)||Pt.includes(e.code)}function Lt({item:e,quantity:t}){var n;const i=[];return At(e)&&i.push(`Quantity: ${t}`),(e.runeword||7===e.quality||5===e.quality)&&(100===e.perfectionScore?i.push("Perfect"):i.push(`${e.perfectionScore}% perfect`)),e.ethereal&&i.push("Ethereal"),e.runeword&&i.push(qe(e).name),(null!==(n=e.quality)&&void 0!==n?n:10)<=3&&!e.runeword&&e.sockets&&i.push(`${e.sockets} sockets`),Z(C,{children:i.join(", ")},void 0)}K(".item td,.item th{text-align:left}.item th{font-weight:inherit;width:400px}.item td:first-child{width:2em}");K(".tooltip-container{position:relative}.tooltip-trigger{cursor:pointer}.tooltip-content{bottom:-1px;height:1px;overflow:hidden;position:fixed;text-align:center;white-space:nowrap;width:1px}.tooltip-container:focus-within .tooltip-content,.tooltip-container:hover .tooltip-content{background:rgba(0,0,0,.9);border:2px solid #fff;bottom:calc(100% + .4em);height:auto;left:0;padding:.4em .8em;position:absolute;width:auto}");let Tt=0;function Ut({range:e}){return e?Z("span",Object.assign({class:"sidenote"},{children:[" [",e.join(" - "),"]"]}),void 0):null}function Dt({item:e}){var t,n,i,o,r,s;const[a]=ue((()=>"item-tooltip-"+Tt++)),l=function(e){if(e.runeword)return"unique";switch(e.quality){case 4:return"magic";case 6:return"rare";case 7:return"unique";case 5:return"set";case 8:return"crafted"}return e.sockets||e.ethereal?"socketed":""}(e);if(e.simple)return Z("span",Object.assign({class:l},{children:e.name}),void 0);const c=qe(e),d=null!==(n=null===(t=e.modifiers)||void 0===t?void 0:t.map((({description:e,range:t})=>e&&Z("div",Object.assign({class:"magic"},{children:[e,Z(Ut,{range:t},void 0)]}),void 0))))&&void 0!==n?n:[];if(e.ethereal||e.sockets){const t=[e.ethereal&&"Ethereal",e.sockets&&`Socketed (${e.sockets})`].filter((e=>!!e));null==d||d.push(Z("div",Object.assign({class:"magic"},{children:[t.join(", "),Z(Ut,{range:e.socketsRange},void 0)]}),void 0))}const u=null===(i=e.setItemModifiers)||void 0===i?void 0:i.flatMap((e=>e.map((({description:e,range:t})=>e&&Z("div",Object.assign({class:"set"},{children:[e," ",Z(Ut,{range:t},void 0)]}),void 0))))),h=null===(o=e.setGlobalModifiers)||void 0===o?void 0:o.flatMap((e=>e.map((({description:e})=>e&&Z("div",Object.assign({class:"unique"},{children:e}),void 0)))));return null==h||h.unshift(Z("br",{},void 0)),Z("span",Object.assign({class:"tooltip-container"},{children:[Z("span",Object.assign({class:`tooltip-trigger ${l}`,tabIndex:0,"aria-describedby":a},{children:e.name}),void 0),Z("div",Object.assign({id:a,class:"tooltip-content",role:"tooltip"},{children:[Z("div",Object.assign({class:l},{children:e.name}),void 0),Z("div",Object.assign({class:l},{children:null==c?void 0:c.name}),void 0),Z("div",{children:["Item Level: ",e.level]},void 0),"def"in c&&Z("div",{children:["Defense:"," ",Z("span",Object.assign({class:e.enhancedDefense?"magic":""},{children:[e.defense,Z(Ut,{range:e.defenseRange},void 0)]}),void 0)]},void 0),e.durability&&Z("div",{children:["Durability: ",null===(r=e.durability)||void 0===r?void 0:r[0]," of"," ",e.durability[1]+(null!==(s=e.extraDurability)&&void 0!==s?s:0)]},void 0),d,u,h]}),void 0)]}),void 0)}function Ht({item:e}){let t="";switch(e.code){case"amu":t="(Amulet)";break;case"rin":t="(Ring)"}return Z("a",Object.assign({class:"location"},{children:[" ",t," "]}),void 0)}function Ft({item:e,duplicates:t,selectable:n,withLocation:i}){const{selectedItems:o,toggleItem:r,selectAll:s,unselectAll:a}=me(dt),l=ve((()=>{t?o.has(e)?a(t):s(t):r(e)}),[t,e,s,o,r,a]);return Z("tr",Object.assign({class:"item"},{children:[n&&Z("td",{children:Z("input",{type:"checkbox",checked:o.has(e),onChange:l,"aria-label":e.name},void 0)},void 0),Z("th",Object.assign({scope:"row","aria-label":e.name},{children:[" ",Z(Ht,{item:e},void 0),Z(Dt,{item:e},void 0)]}),void 0),Z("td",{children:Z(Lt,{item:e,quantity:null==t?void 0:t.length},void 0)},void 0),i&&Z("td",{children:Z(qt,{item:e},void 0)},void 0)]}),void 0)}K(".page-title{border-bottom:1px solid #666;display:flex;flex-flow:row;justify-content:space-between}.page{table-layout:fixed;width:100%}");function zt(e){return"name"in e?e.name||(void 0!==e.flags&&e.flags%2?"Shared Page #":"Personal Page #"):"Shared Page #"}function Wt(e){const t=new Map;let n=0;for(const i of e)if(At(i)){const e=t.get(i.code);e?0!==e[0].location&&0===i.location||5!==e[0].stored&&5===i.stored?e.unshift(i):e.push(i):t.set(i.code,[i])}else t.set(""+n++,[i]);return Array.from(t.values())}function Rt({page:e,index:t}){var n,i;const o=(null!==(n=e.flags)&&void 0!==n?n:0)>=4?"Main index":(null!==(i=e.flags)&&void 0!==i?i:0)>=2?"Index":"",r=pe((()=>Wt(e.items)),[e.items]);return Z("section",{children:[Z("h3",Object.assign({class:"page-title"},{children:[Z("span",{children:zt(e).replace("#",`${t+1}`)},void 0),Z("span",{children:o},void 0)]}),void 0),Z("table",Object.assign({class:"page"},{children:Array.from(r.values()).map(((e,t)=>{var n;return Z(Ft,{item:e[0],duplicates:e,selectable:!0,withLocation:!1},null!==(n=e[0].id)&&void 0!==n?n:t)}))}),void 0)]},void 0)}function Vt({value:e,onChange:t,children:n}){return Z("div",{children:[Z("p",{children:Z("label",Object.assign({for:"search-input"},{children:n}),void 0)},void 0),Z("p",{children:Z("input",{id:"search-input",type:"search",value:e,onInput:({currentTarget:e})=>t(e.value)},void 0)},void 0)]},void 0)}function Bt(e,t,n){if(!t)return e;const i=t.toLocaleLowerCase().split(/"([^"]*)"|\s+/).filter(Boolean);return e.filter((e=>{const t=qe(e);return i.every((i=>{var o;return(null==n?void 0:n.toLocaleLowerCase().includes(i))||(null===(o=e.name)||void 0===o?void 0:o.toLocaleLowerCase().includes(i))||t.name.toLocaleLowerCase().includes(i)||e.search.includes(i)}))}))}function Yt({value:e,onChange:t}){return Z("div",{children:[Z("p",{children:Z("label",Object.assign({for:"quality-select"},{children:"Filter by quality:"}),void 0)},void 0),Z("p",{children:Z("select",Object.assign({id:"quality-select",value:e,onChange:({currentTarget:e})=>t(e.value)},{children:[Z("option",Object.assign({value:"all"},{children:"All"}),void 0),Z("option",Object.assign({value:"normal"},{children:"Non-magical"}),void 0),Z("option",Object.assign({value:"superior"},{children:"Superior"}),void 0),Z("option",Object.assign({value:"magic"},{children:"Magic"}),void 0),Z("option",Object.assign({value:"rare"},{children:"Rare"}),void 0),Z("option",Object.assign({value:"unique"},{children:"Unique"}),void 0),Z("option",Object.assign({value:"dupu"},{children:"Duplicates(Unique)"}),void 0),Z("option",Object.assign({value:"set"},{children:"Set"}),void 0),Z("option",Object.assign({value:"dups"},{children:"Duplicates(Set)"}),void 0),Z("option",Object.assign({value:"runeword"},{children:"Rune word"}),void 0),Z("option",Object.assign({value:"crafted"},{children:"Crafted"}),void 0),Z("option",Object.assign({value:"misc"},{children:"Non-equipment"}),void 0)]}),void 0)},void 0)]},void 0)}function Gt(e,t){if("all"===t)return e;if(console.error(e.length),"dups"===t||"dupu"===t){console.error(t);const n=new Set,i=new Set,o="dupu"===t?7:5;for(const t of e.filter((e=>e.quality===o)))n.has(t.name)?i.add(t.name):n.add(t.name);return e.filter((e=>e.quality===o&&i.has(e.name))).sort(((e,t)=>e.name>t.name?1:-1))}return e.filter((e=>{var n;switch(t){case"normal":return(null!==(n=e.quality)&&void 0!==n?n:10)<=3&&!e.runeword;case"superior":return 3===e.quality&&!e.runeword;case"magic":return 4===e.quality;case"rare":return 6===e.quality;case"unique":return 7===e.quality;case"set":return 5===e.quality;case"runeword":return e.runeword;case"crafted":return 8===e.quality;case"misc":return e.simple}}))}K(".controls{align-items:center;border-bottom:1px solid #666;display:flex;flex-flow:row nowrap;padding:1em 0}.controls>:not(:last-child){border-right:1px solid #666;padding-right:2em}.controls>:not(:first-child){padding-left:2em}.controls p:first-child{margin-top:0}.controls p:last-child{margin-bottom:0}.controls input,.controls select{width:100%}");const Jt=["Equipped","Corpse","Mercenary","Inventory","Cube","Belt","Stash","Unknown"];function Qt(e){switch(e.location){case 0:switch(e.stored){case 5:return"Stash";case 1:return"Inventory";case 4:return"Cube";case 0:return"Unknown"}throw new Error(`Unknown storage type ${e.stored}`);case 2:return"Belt";case 1:return e.mercenary?"Mercenary":e.corpse?"Corpse":"Equipped";case 6:case 4:return"Unknown"}}function Zt({items:e}){const{selectedItems:t,selectAll:n,unselectAll:i}=me(dt),o=pe((()=>e.every((e=>t.has(e)))),[e,t]);return Z("div",{children:Z("button",Object.assign({class:"button",onClick:()=>o?i(e):n(e)},{children:[o?"Unselect":"Select"," all ",e.length," item",e.length>1?"s":""]}),void 0)},void 0)}function Kt(){const{owners:e,lastActivePlugyStashPage:t}=me(ht),[n,i]=ue((()=>Math.max(0,e.findIndex((e=>Xe(e)&&!e.personal))))),[o,r]=ue(""),[s,a]=ue("all"),[l,c]=ue(0),d=e[n],u=pe((()=>d?Ke(d)?d.pages:function(e,t){const n=new Map;function i(e,t){let i=n.get(e);i||(i={name:e,items:[]},n.set(e,i)),i.items.push(t)}for(const t of e.items)i(Qt(t),t);return Jt.map((e=>n.get(e))).filter((e=>!(!e||t&&"Stash"===e.name)))}(d,!!(null==t?void 0:t.get(d))):[]),[d,t]),h=pe((()=>{var e;return null!==(e=u.map(((e,t)=>({...e,name:zt(e).replace("#",`${t+1}`),items:Gt(Bt(e.items,o,"name"in e?e.name:""),s)}))).filter((({items:e})=>e.length>0)))&&void 0!==e?e:[]}),[u,o,s]),f=pe((()=>h.flatMap((({items:e})=>e))),[h]);he((()=>{c(0)}),[d]);const p=Z(Mt,{nbEntries:h.length,pageSize:10,currentEntry:l,onChange:c,text:(e,t)=>`Pages ${e} - ${t} out of ${h.length}`},void 0);return Z(C,{children:[Z("div",Object.assign({class:"controls"},{children:[Z("div",{children:[Z("p",{children:Z("label",Object.assign({for:"character-select"},{children:"Select a character:"}),void 0)},void 0),Z("p",{children:Z("select",Object.assign({id:"character-select",value:n,onChange:({currentTarget:e})=>i(Number(e.value))},{children:e.map(((e,t)=>Z("option",Object.assign({value:t},{children:tt(e)}),void 0)))}),void 0)},void 0)]},void 0),Z(Vt,Object.assign({value:o,onChange:r},{children:"Search for an item or a page:"}),void 0),Z(Yt,{value:s,onChange:a},void 0),Z(Zt,{items:f},void 0)]}),void 0),p,Z("div",{children:h.slice(l,l+10).map(((e,t)=>Z(Rt,{page:e,index:t+l},t)))},void 0),p]},void 0)}K("#navigation{align-items:flex-end;border-bottom:1px solid #666;display:flex;flex-flow:row nowrap}a.nav-link{color:#aaa;margin:0 1em;padding-bottom:.4em;text-decoration:none}a.nav-link.active{border-bottom:1px solid #fff;color:#fff;margin-bottom:-1px}");function Xt({items:e,pageSize:t,selectable:n}){const[i,o]=ue(0),r=pe((()=>Wt(e)),[e]);return he((()=>{o(0)}),[e]),Z(C,{children:[Z(Mt,{nbEntries:r.length,pageSize:t,currentEntry:i,onChange:o,text:(t,n)=>Z(C,{children:["Items ",t," - ",n," out of ",r.length," ",Z("span",Object.assign({class:"sidenote"},{children:["(",e.length," with duplicates)"]}),void 0)]},void 0)},void 0),Z("table",Object.assign({id:"collection"},{children:[Z("thead",{children:Z("tr",Object.assign({class:"sidenote"},{children:[Z("th",{children:Z("span",Object.assign({class:"sr-only"},{children:"Select"}),void 0)},void 0),Z("th",{children:"Item"},void 0),Z("th",{children:"Characteristics"},void 0),Z("th",{children:"Location"},void 0)]}),void 0)},void 0),Z("tbody",{children:r.slice(i,i+t).map(((e,t)=>{var i;return Z(Ft,{item:e[0],duplicates:e,selectable:n,withLocation:!0},null!==(i=e[0].id)&&void 0!==i?i:t)}))},void 0)]}),void 0)]},void 0)}function en(){const{allItems:e}=me(ht),[t,n]=ue(""),[i,o]=ue("all"),[r,s]=ue(20),a=pe((()=>Gt(Bt(e,t),i)),[e,t,i]);return Z(C,{children:[Z("div",Object.assign({class:"controls"},{children:[Z(Vt,Object.assign({value:t,onChange:n},{children:"Search for an item:"}),void 0),Z(Yt,{value:i,onChange:o},void 0),Z("div",{children:[Z("p",{children:Z("label",Object.assign({for:"page-size-select"},{children:"Items per page:"}),void 0)},void 0),Z("p",{children:Z("select",Object.assign({id:"page-size-select",value:r,onChange:({currentTarget:e})=>s(Number(e.value))},{children:[Z("option",Object.assign({value:10},{children:"10"}),void 0),Z("option",Object.assign({value:20},{children:"20"}),void 0),Z("option",Object.assign({value:50},{children:"50"}),void 0),Z("option",Object.assign({value:100},{children:"100"}),void 0)]}),void 0)},void 0)]},void 0),Z(Zt,{items:a},void 0)]}),void 0),Z(Xt,{items:a,selectable:!0,pageSize:r},void 0)]},void 0)}function tn({folder:e,children:t}){const{setCollection:n,setSingleFile:i}=me(ht),o=fe(null),r=ve((async()=>{var t,r,s;if(null===(t=o.current)||void 0===t?void 0:t.files){const t=[];for(const e of o.current.files)e.webkitRelativePath.split("/").length>2||(e.name.endsWith(".sss")||e.name.endsWith(".d2x")||e.name.endsWith(".d2s")||e.name.endsWith(".d2i"))&&t.push(e);if(e)await(s=t,at.then((e=>new Promise(((t,n)=>{const i=e.transaction(st,"readwrite"),o=i.objectStore(st);o.clear();for(const e of s)o.add(e);i.onerror=function(){n("Unable to store save files.")},i.oncomplete=function(){t()}}))))),n(await Promise.all(t.map((e=>ot(e)))));else{const e=t[0];await(r=e,at.then((e=>new Promise(((t,n)=>{const i=e.transaction(st,"readwrite").objectStore(st).put(r);i.onerror=function(){n("Unable to store save file.")},i.onsuccess=function(){t()}}))))),i(await ot(e))}o.current.value=""}}),[e,n,i]),s=e?{directory:!0,webkitdirectory:!0,multiple:!0}:{accept:".sss,.d2x,.d2s,.d2i"};return Z("span",Object.assign({class:"filepicker"},{children:[Z("button",Object.assign({class:e?"button":"button danger",onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()}},{children:t}),void 0),Z("input",Object.assign({class:"hidden",ref:o,type:"file"},s,{onChange:r}),void 0)]}),void 0)}K("#collection{border-collapse:collapse;margin-top:2em;width:100%}#collection thead th{padding-bottom:.4em}#collection .item td:not(:first-child){padding:0 2em}#collection tbody .item th{padding-top:.3em}#collection tr{border-bottom:1px solid #222}#collection tbody tr:hover td:not(:first-child){color:#6fb76f}");K("#save-files{border-collapse:collapse}#save-files td,#save-files th{border:1px solid #666;padding:.4em 1em}.filepicker:first-child{margin-right:1em}");function nn({owner:e}){return Xe(e)?e.personal?Z(C,{children:[Z("span",Object.assign({class:"unique"},{children:e.filename.slice(0,-4)}),void 0),"'s stash"]},void 0):Z("span",Object.assign({class:"magic"},{children:e.nonPlugY?"Offline stash":"PlugY shared stash"}),void 0):et(e)?Z("span",Object.assign({class:"unique"},{children:e.filename.slice(0,-4)}),void 0):Z("span",Object.assign({class:"magic"},{children:"Shared"}),void 0)}const on=Intl.DateTimeFormat(void 0,{dateStyle:"long",timeStyle:"medium"});function rn(){const{owners:e}=me(ht),[t,n]=ue(!1),i=pe((()=>{const t=[];for(const n of e)t.push(Z("tr",{children:[Z("td",{children:Z(nn,{owner:n},void 0)},void 0),Z("td",{children:n.version<=96?"Legacy Diablo 2":"Diablo 2 Resurrected"},void 0),Z("td",{children:on.format(new Date(n.lastModified))},void 0)]},void 0));return t}),[e]);return Z(C,{children:[Z("p",Object.assign({class:"sidenote"},{children:"Simply select your Diablo 2 save folder, and this tool will detect all items on every character and in every stash."}),void 0),Z("p",{children:[Z(tn,Object.assign({folder:!0},{children:[0===e.length?"Upload":"Refresh"," all my save files"]}),void 0),!t&&Z("button",Object.assign({class:"button sidenote",onClick:()=>window.confirm("Uploading a single stash at a time is not recommended, because you risk losing items that were moved between characters since the last upload or download.\n\nAre you sure you want to proceed?")&&n(!0)},{children:"Let me select a single file"}),void 0),t&&Z(tn,Object.assign({folder:!1},{children:[0===e.length?"Upload":"Update"," a single file"]}),void 0)]},void 0),Z("table",Object.assign({id:"save-files"},{children:[Z("tr",{children:[Z("th",{children:"Character name"},void 0),Z("th",{children:"Game version"},void 0),Z("th",{children:"Save date"},void 0)]},void 0),i]}),void 0)]},void 0)}function sn({href:e,children:t}){return Z("a",Object.assign({href:e,target:"_blank"},{children:[t," ",Z("svg",Object.assign({class:"external-link-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},{children:[Z("title",{children:"(opens in new tab)"},void 0),Z("path",{fill:"currentColor",d:"M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"},void 0)]}),void 0)]}),void 0)}K(".external-link-icon{display:inline-block;height:.6em}");K('.faq-question .button{border:none;color:#c7b377;font-size:18px;font-size:1.2em;padding:.5em .4em}.faq-question .button:before{content:"▸";display:inline-block;margin-right:.5em;transition:transform .4s}.faq-question.expanded .button:before{transform:rotate(90deg)}.faq-answer{border-left:1px solid #c7b377;height:0;margin-left:.75em;overflow:hidden;padding-left:1em}.faq-answer.expanded{height:auto;padding-bottom:.5em}.faq-answer>:first-child{margin-top:0}.faq-answer>:last-child{margin-bottom:0}');function an({question:e,startExpanded:t,children:n}){const[i]=ue((()=>"faq-0")),[o,r]=ue(t),s=fe(null),a=ve((()=>{r((e=>{var t;return null===(t=s.current)||void 0===t||t.animate([{height:"0px"},{height:`${s.current.scrollHeight}px`}],{duration:400,easing:"ease-in-out",direction:e?"reverse":"normal"}),!e}))}),[]);return Z(C,{children:[Z("dt",Object.assign({class:"faq-question "+(o?"expanded":"")},{children:Z("button",Object.assign({class:"button","aria-expanded":o,"aria-controls":i,onClick:a},{children:e}),void 0)}),void 0),Z("dd",Object.assign({ref:s,class:"faq-answer accessible-font "+(o?"expanded":""),id:i},{children:n}),void 0)]},void 0)}function ln(){return Z("dl",Object.assign({id:"faq"},{children:[Z(an,Object.assign({question:"I'm new here, what's this website?",startExpanded:!0},{children:[Z("p",{children:["This tool is a collection manager for all of your single-player items in Diablo 2. You ",Z("a",Object.assign({href:"#saves"},{children:"select your save folder"}),void 0),", the tool reads every single character file and stash in it, turning it into an ",Z("a",Object.assign({href:"#collection"},{children:"easily searchable collection"}),void 0),'. Each item is evaluated with a perfection score, so you can quickly identify your 35% Spirit without inspecting all of them. When searching for an item, the tool gives a precise location to help you find it: "Worn by Hammerdin\'s Mercenary", or "In Fishymancer\'s Cube".']},void 0),Z("p",{children:["You can also use this website as a replacement for GoMule. It allow you to"," ",Z("a",Object.assign({href:"#transfer"},{children:"transfer items from one character to another"}),void 0),", either in bulk or a few at a time, and gives you the updated save files to download. It can also create an off-game stash to store as many items as you need if you do not have enough mules."]},void 0),Z("p",{children:["If you are more of a PlugY fan than GoMule, this tool is fully PlugY-compatible. If your save folder contains PlugY stashes, these are fully parsed too. And it offers a feature to"," ",Z("a",Object.assign({href:"#organize"},{children:"fully sort and organize"}),void 0)," your PlugY stash in one click, no matter how many items you hoarded."]},void 0),Z("p",{children:["Finally, this website also serves as a"," ",Z("a",Object.assign({href:"#grail-tracker"},{children:"Grail tracker"}),void 0)," that you never have to manually update. Simply refresh your save files and you will immediately see your progress."]},void 0)]}),void 0),Z(an,Object.assign({question:"Is this compatible with Diablo 2 Resurrected?"},{children:"Yes! You can seamlessly transfer items between legacy D2 and D2 Resurrected characters, for instance using your legacy PlugY stash as an offline D2R stash."}),void 0),Z(an,Object.assign({question:'When you say "easily searchable", what can I search for?'},{children:[Z("p",{children:"When searching in your collection, you can search for:"},void 0),Z("ul",{children:[Z("li",{children:'Item names: "Tal Rasha"'},void 0),Z("li",{children:'Modifiers: "All res"'},void 0),Z("li",{children:'Number of sockets: "3 sockets"'},void 0),Z("li",{children:'Items in sockets: "Rainbow Facet"'},void 0)]},void 0),Z("p",{children:'When searching on a character, you can also search for a specific location, like "Equipped" or "Mercenary". When searching in a stash, you can search for a specific page, like "Shared page 42".'},void 0),Z("p",{children:'Finally, like most search tools, using double-quotes " will force a perfect match. You can combine this to create advanced searches like:'},void 0),Z("blockquote",{children:'"4 sockets" "15% enhanced"'},void 0),Z("p",{children:"To help you find your items in-game, the search results indicate very precisely where each item is:"},void 0),Z("p",{children:Z("img",{src:"examples/item-finder.png",style:"max-width",alt:"Three Andariel's Visages, one worn by a mercenary, one in a cube, and one on page 48 of the shared stash"},void 0)},void 0)]}),void 0),Z(an,Object.assign({question:'What do you mean by "perfection score"?'},{children:[Z("p",{children:"Many unique and set items have can roll properties and modifiers within a range. For instance, Tal Rasha's Lidless Eye can drop +1 or +2 to each elemental mastery. This is displayed using brackets next to each property that can vary:"},void 0),Z("p",{children:Z("img",{src:"examples/item-info.png",style:"max-width",alt:"Three Andariel's Visages, one worn by a mercenary, one in a cube, and one on page 48 of the shared stash"},void 0)},void 0),Z("p",{children:'In this case, it dropped with +1 Cold Mastery, +2 Lightning Mastery and +2 Fire Mastery. As such, it has 2 perfect rolls out of 3, which makes it "66% perfect".'},void 0)]}),void 0),Z(an,Object.assign({question:"Where am I uploading my save files?"},{children:["Nowhere! Your data is yours, this website does not send anything to the server. In fact, once the page has been loaded, the tool works fully offline if you want to. If you're not convinced, the entire source code for this project is"," ",Z(sn,Object.assign({href:"https://github.com/youdz/d2-stash-organizer"},{children:"open-source on GitHub"}),void 0),"."]}),void 0),Z(an,Object.assign({question:"Is this compatible with PlugY?"},{children:["Not only is it fully compatible with PlugY stashes, it also lets you"," ",Z("a",Object.assign({href:"#organize"},{children:"fully sort and organize"}),void 0)," them in one click. We all know how long we've been putting off cleaning our stash, well now we don't have to!"]}),void 0),Z(an,Object.assign({question:"How will this sort my very large PlugY stash?"},{children:[Z("p",{children:"That's a pretty long answer, but you asked for it. Not that you cannot configure the sort order, but you can tell the organizer to leave untouched any number of pages at the start of your stash, or tell it to add extra empty pages at the beginning."},void 0),Z("ol",{children:[Z("li",{children:"Rejuvenation potions"},void 0),Z("li",{children:"Essences and tokens"},void 0),Z("li",{children:"Organs and keys"},void 0),Z("li",{children:"Gems: every gem type gets its own page(s), each page sorted by grade of gem (from chipped to perfect)"},void 0),Z("li",{children:"Runes by rank, with an empty line between each rank for clarity"},void 0),Z("li",{children:"Bases (white and grey items), ordered by:"},void 0),Z("ol",{children:[Z("li",{children:"Equipment type (same order as the equipment sections below)"},void 0),Z("li",{children:["Within each equipment type, sorted by descending"," ",Z(sn,Object.assign({href:"http://classic.battle.net/diablo2exp/items/basics.shtml#qlevel"},{children:"qlevel"}),void 0)," ","(meaning Sacred Armor first and Quilted Armor last, for instance)"]},void 0),Z("li",{children:"Within each qlevel, sorted by number of sockets (useful if you have 12 Crystal Swords)"},void 0)]},void 0),Z("li",{children:"Runewords sorted by level requirement"},void 0),Z("li",{children:"For each type of possibly unique item (rings, amulets, charms, jewels, armor, helms, gloves, ...):"},void 0),Z("ol",{children:[Z("li",{children:'One of each unique displayed in "grail mode", one page per tier (normal, exceptional, elite) if they don\'t fit on one page'},void 0),Z("li",{children:'One of each eth unique displayed in "grail mode"'},void 0),Z("li",{children:"Duplicate uniques sorted by descending qlevel"},void 0),Z("li",{children:"Rares sorted by descending qlevel"},void 0),Z("li",{children:"Magic items sorted by descending qlevel"},void 0)]},void 0),Z("li",{children:"For each set:"},void 0),Z("ol",{children:[Z("li",{children:"A first pretty page with the set fully laid out"},void 0),Z("li",{children:"Duplicate items of the same set, grouped by which piece it is, just laid out in line"},void 0)]},void 0)]},void 0),Z("p",{children:"Here are some example pages after organization:"},void 0),Z("p",{children:[Z("img",{src:"examples/armor.png",alt:"Unique normal armors organized by level"},void 0),Z("img",{src:"examples/runes.png",alt:"Low-level runes layed out line by line"},void 0),Z("img",{src:"examples/cathan.png",alt:"Cathan's Traps set nicely layed out on a single page"},void 0),Z("img",{src:"examples/sigon.png",alt:"Sigon's Complete Steel set nicely layed out on a single page"},void 0)]},void 0)]}),void 0),Z(an,Object.assign({question:"Can this be used to edit, hack or mod items?"},{children:"The tool does not have the capability to modify item stats, skills or properties. The only fields that can be modified at the moment are the ones related to the item's location."}),void 0),Z(an,Object.assign({question:"How do I transfer many items at once?"},{children:[Z("p",{children:["Go to ",Z("a",Object.assign({href:"#collection"},{children:"your collection"}),void 0)," or a specific"," ",Z("a",Object.assign({href:"#characters"},{children:"character or stash page"}),void 0),'. Search for the items you want (or do not search if you want to transfer all items), and click the "Select all items" button. This will select all items returned by the search. After that, simply go to the'," ",Z("a",Object.assign({href:"#characters"},{children:"transfer page"}),void 0)," and select where you want to send them."]},void 0),Z("p",{children:"There is no limit to how many items you can transfer at once, provided you have enough room at the destination. For instance, you can transfer thousands of items in one click from a personal PlugY stash to the shared stash:"},void 0),Z("p",{children:Z("img",{src:"examples/bulk-transfer.png",alt:"Unique normal armors organized by level"},void 0)},void 0)]}),void 0),Z(an,Object.assign({question:"How do I transfer all items in a single stash page?"},{children:["Go to ",Z("a",Object.assign({href:"#characters"},{children:"that stash"}),void 0),', and search for the exact page name (for instance, "Shared Page 42"). Click the "Select all items" button, the ',Z("a",Object.assign({href:"#characters"},{children:"transfer page"}),void 0)," will now transfer exactly the items in that page."]}),void 0),Z(an,Object.assign({question:"How do I get help or report a bug?"},{children:[Z("p",{children:["First, check if someone else already"," ",Z(sn,Object.assign({href:"https://github.com/youdz/d2-stash-organizer/issues"},{children:"asked that question or reported the bug on GitHub"}),void 0),". If you don't find your answer, go ahead and"," ",Z(sn,Object.assign({href:"https://github.com/youdz/d2-stash-organizer/issues/new"},{children:"submit an issue"}),void 0)," ","for it."]},void 0),Z("p",{children:["If you do not have a GitHub account and do not want to create one, which is completely understandable, you can reach out to me on"," ",Z(sn,Object.assign({href:"https://twitter.com/EudesPV"},{children:"Twitter"}),void 0)," ","or"," ",Z(sn,Object.assign({href:"https://www.reddit.com/user/EudesPV/"},{children:"Reddit"}),void 0)]},void 0)]}),void 0)]}),void 0)}K(".radiolist{list-style:none;padding:0}");const cn=J({accessibleFont:!1,toggleAccessibleFont:()=>{}});function dn({children:e}){const[t,n]=ue((()=>"true"===localStorage.getItem("accessibleFont"))),i=ve((()=>{n((e=>(localStorage.setItem("accessibleFont",`${!e}`),!e)))}),[]),o=pe((()=>({accessibleFont:t,toggleAccessibleFont:i})),[t,i]);return Z(cn.Provider,Object.assign({value:o},{children:e}),void 0)}function un(){const{accessibleFont:e,toggleAccessibleFont:t}=me(cn);return Z(C,{children:[Z("p",{children:Z("label",{children:[Z("input",{type:"checkbox",name:"font",checked:!e,onChange:t},void 0)," ","Use Diablo font"]},void 0)},void 0),Z("p",Object.assign({class:"sidenote"},{children:"More settings to come..."}),void 0)]},void 0)}function hn({hash:e,isHome:t,children:n}){const i=location.hash===e||t&&""===location.hash;return Z("a",Object.assign({class:i?"nav-link active":"nav-link",href:e},{children:n}),void 0)}function fn(){const[e,t]=ue(location.hash);he((()=>{const e=()=>t(location.hash);return window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)}),[]);const n=pe((()=>{switch(e){case"#saves":return Z(rn,{},void 0);case"#collection":return Z(en,{},void 0);case"#characters":return Z(Kt,{},void 0);case"#grail-tracker":return Z($t,{},void 0);case"#settings":return Z(un,{},void 0);default:return Z(ln,{},void 0)}}),[e]);return Z(C,{children:[Z("nav",Object.assign({id:"navigation","data-nosnippet":!0},{children:[Z(hn,Object.assign({hash:"#saves"},{children:"Save files"}),void 0),Z(hn,Object.assign({hash:"#collection"},{children:"Collection"}),void 0),Z(hn,Object.assign({hash:"#characters"},{children:"Characters"}),void 0),Z(hn,Object.assign({hash:"#grail-tracker"},{children:"Grail tracker"}),void 0),Z(hn,Object.assign({hash:"#settings"},{children:"Settings"}),void 0)]}),void 0),Z("main",{children:n},void 0)]},void 0)}function pn(){return Z("a",Object.assign({id:"help-link",href:"#help","aria-label":"Help"},{children:"?"}),void 0)}K("#help-link{border:2px solid;border-color:initial;border-radius:50%;box-sizing:border-box;display:block;float:right;font-size:26px;height:32px;line-height:28px;margin-right:18px;padding-left:6px;padding-top:2px;width:32px}"),function(e,t,n){var i,o,r;_.__&&_.__(e,t),o=(i="function"==typeof n)?null:n&&n.__k||t.__k,r=[],W(t,e=(!i&&n||t).__k=function(e,t,n){var i,o,r,s={};for(r in t)"key"==r?i=t[r]:"ref"==r?o=t[r]:s[r]=t[r];if(arguments.length>2&&(s.children=arguments.length>3?g.call(arguments,2):n),"function"==typeof e&&null!=e.defaultProps)for(r in e.defaultProps)void 0===s[r]&&(s[r]=e.defaultProps[r]);return E(e,s,i,o,null)}(C,null,[e]),o||S,S,void 0!==t.ownerSVGElement,!i&&n?[n]:o?null:t.firstChild?g.call(t.childNodes):null,r,!i&&n?n:o?o.__e:t.firstChild,i),R(r,e)}(Z((function({children:e}){return Z(dn,{children:Z(ut,{children:Z(pt,{children:e},void 0)},void 0)},void 0)}),{children:Z((function(){const{accessibleFont:e}=me(cn);return Z("div",Object.assign({id:"app",class:e?"accessible-font":""},{children:[Z(X,{},void 0),Z(pn,{},void 0),Z("h1",{children:"Diablo 2 Reimagined Collection Manager"},void 0),Z(fn,{},void 0)]}),void 0)}),{},void 0)},void 0),document.body,document.getElementById("app"));
